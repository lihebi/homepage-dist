<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Linux</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="/assets/org.css" /><link rel="stylesheet" type="text/css" href="/assets/hebi.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href=""> UP </a>
 |
 <a accesskey="H" href="/"> HOME </a>
</div><div id="content">
<h1 class="title">Linux</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgf31d721">1. Tmp</a>
<ul>
<li><a href="#orgc668d88">1.1. sudo</a></li>
<li><a href="#org476a3b2">1.2. compilation and linking</a></li>
<li><a href="#orgdc90d66">1.3. Arduino</a></li>
<li><a href="#org4eb82d7">1.4. Deep Learning Framework GPU setup</a></li>
</ul>
</li>
<li><a href="#org327b10b">2. Installation</a>
<ul>
<li><a href="#orgcd1d00f">2.1. Virtualization</a></li>
</ul>
</li>
<li><a href="#orga8574d0">3. GuixSD</a>
<ul>
<li><a href="#org6b30afd">3.1. Qemu Image</a></li>
<li><a href="#orgb3464e4">3.2. Guile</a></li>
<li><a href="#orga1e2251">3.3. Guix</a></li>
<li><a href="#orgd856511">3.4. Developing Guix packages</a></li>
<li><a href="#orgc8e97e9">3.5. Bootloader</a></li>
<li><a href="#org740d469">3.6. Nvidia driver</a></li>
<li><a href="#org21549f5">3.7. Guix on Foreign distribution</a>
<ul>
<li><a href="#org4b117a6">3.7.1. Trouble Shooting</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgd21dbd2">4. Git</a>
<ul>
<li><a href="#org8ad97cf">4.1. Configuration</a></li>
<li><a href="#orgd88d1b8">4.2. Server</a>
<ul>
<li><a href="#orgda7308c">4.2.1. <span class="todo TODO">TODO</span> gitolite</a></li>
</ul>
</li>
<li><a href="#org7180258">4.3. Individual tools</a>
<ul>
<li><a href="#org43cc32d">4.3.1. git-bisect</a>
<ul>
<li><a href="#org8428bec">4.3.1.1. start</a></li>
<li><a href="#org7072cb2">4.3.1.2. answer the question</a></li>
<li><a href="#org66f86fd">4.3.1.3. multiple good</a></li>
<li><a href="#orgabaa099">4.3.1.4. run script</a></li>
<li><a href="#org75c847a">4.3.1.5. Some work flows</a></li>
</ul>
</li>
<li><a href="#org3bd611f">4.3.2. git-blame</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org88ff240">5. Network</a>
<ul>
<li><a href="#orgcb8fc1a">5.1. SSH</a></li>
<li><a href="#org07bd8e5">5.2. Wireless Networking</a></li>
<li><a href="#orgb410763">5.3. VPN</a>
<ul>
<li><a href="#orga2a0967">5.3.1. L2tp, IPSec</a></li>
<li><a href="#orgebaa42f">5.3.2. OpenVPN</a>
<ul>
<li><a href="#org4d2a118">5.3.2.1. Server Setup</a></li>
<li><a href="#org3ac8051">5.3.2.2. Client Setup</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org6b18a87">6. App</a>
<ul>
<li><a href="#orgf6ddbbc">6.1. mplayer</a></li>
<li><a href="#org71f7dcc">6.2. youtube-dl</a></li>
<li><a href="#org29bf693">6.3. chrome extensions</a></li>
<li><a href="#org98c9b0b">6.4. Remove viewer</a></li>
<li><a href="#org0c050c1">6.5. mpd</a></li>
<li><a href="#orgd66546f">6.6. fontforge</a></li>
<li><a href="#org9252643">6.7. tmux</a></li>
</ul>
</li>
<li><a href="#org41e6780">7. Window System</a>
<ul>
<li><a href="#org24999b2">7.1. xkill</a></li>
<li><a href="#org2e1a57c">7.2. Display Manager</a></li>
<li><a href="#org427169c">7.3. screen</a></li>
<li><a href="#orgbd11c7a">7.4. cursor</a></li>
<li><a href="#org03abdaf">7.5. Natural Scrolling</a></li>
<li><a href="#orgefa6bfa">7.6. ratpoison</a></li>
<li><a href="#orgc820ed2">7.7. StumpWM</a>
<ul>
<li><a href="#orgf639569">7.7.1. Installation</a>
<ul>
<li><a href="#org98ed20d">7.7.1.1. A better way to install stumpwm</a></li>
<li><a href="#orgedfbd02">7.7.1.2. Live Debugging</a></li>
</ul>
</li>
<li><a href="#org0be3fac">7.7.2. General</a>
<ul>
<li><a href="#org7ef2754">7.7.2.1. Get Help</a></li>
</ul>
</li>
<li><a href="#org98ea764">7.7.3. Window</a></li>
<li><a href="#org74ddbce">7.7.4. Frame</a></li>
<li><a href="#orge5eb477">7.7.5. Groups</a></li>
<li><a href="#orgb85d043">7.7.6. Configuration</a></li>
</ul>
</li>
<li><a href="#org3496b81">7.8. Xmonad</a></li>
<li><a href="#org5f0a64e">7.9. VNC</a></li>
</ul>
</li>
<li><a href="#orge90a939">8. System Management</a>
<ul>
<li><a href="#orgaae1ee9">8.1. Audio</a></li>
<li><a href="#orgb672e38">8.2. Power Management</a></li>
<li><a href="#orgfeab33a">8.3. Booting</a></li>
<li><a href="#org948f333">8.4. User Management</a></li>
<li><a href="#org1602543">8.5. File Management</a>
<ul>
<li><a href="#org07bc6d7">8.5.1. Swap File</a></li>
<li><a href="#orgab5a04e">8.5.2. Back Up &amp; Syncing</a></li>
<li><a href="#org16f570c">8.5.3. MIME</a></li>
</ul>
</li>
<li><a href="#orgfe7dac2">8.6. LVM</a></li>
<li><a href="#orgbe46a72">8.7. Monitor the system information</a></li>
<li><a href="#org67dd1f1">8.8. Extending a logical volume</a></li>
<li><a href="#org48e0c7b">8.9. Reduce a logical volume</a></li>
</ul>
</li>
<li><a href="#orgbd713eb">9. Arch Linux</a>
<ul>
<li><a href="#orgdc2e3dd">9.1. Installation</a>
<ul>
<li><a href="#org5527233">9.1.1. Verify UEFI</a></li>
<li><a href="#orgae3c0a2">9.1.2. System clock</a></li>
<li><a href="#org4e099a4">9.1.3. Partition</a></li>
<li><a href="#orgd200c44">9.1.4. Select mirror</a></li>
<li><a href="#org070152b">9.1.5. Install base system</a></li>
<li><a href="#orgbbfa1a6">9.1.6. chroot</a></li>
<li><a href="#org22a9d5d">9.1.7. Configure</a></li>
<li><a href="#org46cc86a">9.1.8. Config</a></li>
<li><a href="#orgca4d6bd">9.1.9. Dual boot with Windows</a></li>
</ul>
</li>
<li><a href="#orgd983145">9.2. Pacman</a></li>
<li><a href="#org1a0f642">9.3. AUR</a></li>
</ul>
</li>
<li><a href="#org16a6a2a">10. CentOS</a></li>
<li><a href="#org304914d">11. Debian</a>
<ul>
<li><a href="#orgacb5033">11.1. Package</a></li>
<li><a href="#org3356bf1">11.2. Configuration</a>
<ul>
<li><a href="#org5abd059">11.2.1. update-alternatives</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgafd1030">12. Docker</a>
<ul>
<li><a href="#org015c5f5">12.1. Images</a></li>
<li><a href="#orga0ad51b">12.2. Instance</a></li>
<li><a href="#orgcaf7bbd">12.3. Volume</a></li>
</ul>
</li>
<li><a href="#orgf11d1d2">13. Unix Programming</a>
<ul>
<li><a href="#org54e8d28">13.1. Low-level IO</a>
<ul>
<li><a href="#orgdf15197">13.1.1. open</a></li>
<li><a href="#orge388157">13.1.2. close</a></li>
<li><a href="#org7a75b29">13.1.3. read</a></li>
<li><a href="#org58a81fd">13.1.4. write</a></li>
<li><a href="#org690ffaa">13.1.5. fdopen</a></li>
<li><a href="#org7896492">13.1.6. fileno</a></li>
<li><a href="#orgc123342">13.1.7. fd<sub>set</sub></a></li>
<li><a href="#org6d87654">13.1.8. select - synchronous I/O multiplexing</a></li>
<li><a href="#org8c3fafc">13.1.9. sync</a></li>
<li><a href="#orgcd58155">13.1.10. dup</a></li>
</ul>
</li>
<li><a href="#org34328f3">13.2. Date and Time</a>
<ul>
<li><a href="#orge7fcbb5">13.2.1. struct timeval</a></li>
<li><a href="#org7ffb66a">13.2.2. struct timespec</a></li>
<li><a href="#org5e66715">13.2.3. difftime</a></li>
<li><a href="#org1260206">13.2.4. time<sub>t</sub></a></li>
<li><a href="#org10df28c">13.2.5. alarm</a>
<ul>
<li><a href="#orgb4a6270">13.2.5.1. struct itimerval</a></li>
<li><a href="#org34fdbec">13.2.5.2. setitimer</a></li>
<li><a href="#org6ac28b9">13.2.5.3. getitimer(int which, struct itimerval *old)</a></li>
<li><a href="#orga010cfb">13.2.5.4. alarm</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org5ba24cb">13.3. Process</a>
<ul>
<li><a href="#org02d22a6">13.3.1. system</a></li>
<li><a href="#org6fb19f2">13.3.2. getpid</a></li>
<li><a href="#orgc23c344">13.3.3. fork</a></li>
<li><a href="#org216ef71">13.3.4. pipe</a></li>
<li><a href="#org9d167d3">13.3.5. exec</a></li>
<li><a href="#orgf2e5520">13.3.6. wait</a>
<ul>
<li><a href="#org98205d2">13.3.6.1. Status</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org22ba57e">13.4. Unix Signal Handling</a>
<ul>
<li><a href="#orgf255bff">13.4.1. Ordinary signal handling</a></li>
<li><a href="#org9b1d713">13.4.2. SIGSEGV handling</a>
<ul>
<li><a href="#org0c3076b">13.4.2.1. Motivation</a></li>
<li><a href="#org0e22896">13.4.2.2. a new stack</a></li>
<li><a href="#org002cca4">13.4.2.3. libsigsegv</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org0954461">13.5. pThread</a>
<ul>
<li><a href="#orgb88e183">13.5.1. Create threads</a></li>
<li><a href="#orga0fb5b5">13.5.2. Join and Detach</a></li>
</ul>
</li>
<li><a href="#orgafc3882">13.6. Other</a></li>
</ul>
</li>
<li><a href="#orgefae849">14. Shell Utilities</a>
<ul>
<li><a href="#org858acab">14.1. Patch System</a></li>
<li><a href="#orgf2394bb">14.2. tr: translate characters</a></li>
<li><a href="#org2996428">14.3. uniq: report or filter out repeated lines in a file</a></li>
<li><a href="#org48ab40f">14.4. Find</a></li>
</ul>
</li>
<li><a href="#org38d4bd3">15. Trouble Shooting</a>
<ul>
<li><a href="#orgb0684ba">15.1. Cannot su root</a></li>
<li><a href="#org78fd83b">15.2. in docker, cannot open chromium</a></li>
<li><a href="#org3d5c561">15.3. Encoding</a></li>
<li><a href="#orge5ec8b6">15.4. Cannot open shared library</a></li>
<li><a href="#orgd83cdb2">15.5. auto expansion error for latex font</a></li>
<li><a href="#orgcf5bed1">15.6. time not up-to-date</a></li>
<li><a href="#orge306174">15.7. backlight on TP25</a></li>
<li><a href="#orgc5ce462">15.8. xinit won't start</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgf31d721" class="outline-2">
<h2 id="orgf31d721"><span class="section-number-2">1</span> Tmp</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgc668d88" class="outline-3">
<h3 id="orgc668d88"><span class="section-number-3">1.1</span> sudo</h3>
<div class="outline-text-3" id="text-1-1">
<p>
<code>sudo -i</code> will drop you to root shell, even if you don't know root
password!
</p>

<p>
<code>sudo -E</code> will use current user's environment variables
</p>
</div>
</div>


<div id="outline-container-org476a3b2" class="outline-3">
<h3 id="org476a3b2"><span class="section-number-3">1.2</span> compilation and linking</h3>
<div class="outline-text-3" id="text-1-2">
<p>
LD<sub>LIBRARY</sub><sub>PATH</sub> is searched when the program starts, LIBRARY<sub>PATH</sub> is
searched at link time
</p>

<p>
Do NOT set LD<sub>LIBRARY</sub><sub>PATH</sub> in your login shell profile. Either creat a
script:
</p>

<pre class="example">
<code>LD_LIBRARY_PATH=/path/to/lib1:/path/to/lib2:/path/to/lib3</code>
<code>export LD_LIBRARY_PATH</code>
<code>exec /path/to/bin/myprog $@</code>
</pre>

<p>
Or use <code>env</code> to modify one time:
</p>

<pre class="example">
<code>env LD_LIBRARY_PATH=/path/to/lib1:/path/to/lib2:/path/to/lib3 ./myprog</code>
</pre>

<p>
Never:
</p>

<pre class="example">
<code>$ export LD_LIBRARY_PATH=/path/to/lib1:/path/to/lib2:/path/to/lib3</code>
<code>$ ./myprog</code>
</pre>

<p>
Reference: <a href="https://www.hpc.dtu.dk/?page_id=1180">https://www.hpc.dtu.dk/?page_id=1180</a>
</p>

<p>
See also: readelf (-l/d), runpath and rpath: The only difference
between rpath and runpath is the order they are searched
in. Specifically, their relation to LD<sub>LIBRARY</sub><sub>PATH</sub> - rpath is
searched in before LD<sub>LIBRARY</sub><sub>PATH</sub> while runpath is searched in
after. Seems typically use
rpath. <a href="https://amir.rachum.com/blog/2016/09/17/shared-libraries/">https://amir.rachum.com/blog/2016/09/17/shared-libraries/</a>
</p>
</div>
</div>

<div id="outline-container-orgdc90d66" class="outline-3">
<h3 id="orgdc90d66"><span class="section-number-3">1.3</span> Arduino</h3>
<div class="outline-text-3" id="text-1-3">
<pre class="example">
<code>pacman -S arduino arduino-docs arduino-avr-core</code>
<code>gpasswd -a $USER uucp</code>
<code>gpasswd -a $USER lock</code>
<code>modprobe cdc-acm</code>
</pre>
</div>
</div>

<div id="outline-container-org4eb82d7" class="outline-3">
<h3 id="org4eb82d7"><span class="section-number-3">1.4</span> Deep Learning Framework GPU setup</h3>
<div class="outline-text-3" id="text-1-4">
<p>
In ubuntu 18.04:
</p>

<p>
You can install a latest driver, no problem.
</p>


<p>
Install cuda 9.0 (not 9.2, the python package is actually finding
exact 9.0 of the dynamic library, e.g. libcublas.so.9.0). You can
install multiple versions of cuda. Set the $LD<sub>LIBRARY</sub><sub>PATH</sub> to
<code>/usr/local/cuda/lib64</code> if you have made the symlink, otherwise
include the 9.0 entire path.
</p>


<p>
For the current tensorflow (1.12, as of 11/6/2018), install
</p>

<pre class="example">
<code>pip3 install --user tensorflow-gpu</code>
</pre>

<p>
test 
</p>

<pre class="example">
<code>tf.Session().list_devices()</code>
</pre>

<p>
Or actually tf.Session() will output the information, e.g. run this:
</p>

<pre class="example">
<code>sess = tf.Session(config=tf.ConfigProto(log_device_placement=True))</code>
</pre>
</div>
</div>
</div>






<div id="outline-container-org327b10b" class="outline-2">
<h2 id="org327b10b"><span class="section-number-2">2</span> Installation</h2>
<div class="outline-text-2" id="text-2">
<p>
On windows, you need <code>unetbootin</code>. On linux:
</p>

<pre class="example">
<code>dd bs=4M if=/path/to/archlinux.iso of=/dev/sdx &amp;&amp; sync</code>
<code># restore</code>
<code>dd count=1 bs=512 if=/dev/zero of=/dev/sdx &amp;&amp; sync</code>
</pre>

<p>
On Mac:
</p>
<pre class="example">
<code>hdiutil convert -format UDRW -o ~/path/to/target.img ~/path/to/ubuntu.iso</code>
<code>diskutil list, insert usb, diskutil list =&gt; /dev/disk1</code>
<code>diskutil unmountDisk /dev/diskN</code>
<code>sudo dd if=/path/to/downloaded.img of=/dev/rdiskN bs=1m</code>
<code>diskutil eject /dev/diskN</code>
</pre>

<p>
Create MacOS LiveUSB
</p>
<pre class="example">
<code>sudo /Applications/Install\ OS\ X\ Mavericks.app/Contents/Resources/createinstallmedia \</code>
<code>--volume /Volumes/Untitled \</code>
<code>--applicationpath /Applications/InstallXXX.app \</code>
<code>--nointeraction</code>
</pre>
</div>

<div id="outline-container-orgcd1d00f" class="outline-3">
<h3 id="orgcd1d00f"><span class="section-number-3">2.1</span> Virtualization</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Make sure the kernel module <code>kvm</code> and <code>virtio</code> is loaded. Make sure
the CPU virtualization is enabled in BIOS.
</p>


<p>
Using <code>qemu</code>, first create hard disk image file:
</p>

<pre class="example">
<code>qemu-img create -f raw disk_image 30G</code>
</pre>

<p>
Then load the iso file and the hard disk image to install the
system. The <code>-m 1024</code> is crucial, otherwise will result in errors
booting. The <code>-enable-kvm</code> is also crucial for speed. You might need
to enable CPU virtualization in BIOS.
</p>
<pre class="example">
<code>qemu-system-x86_64 -cdrom iso_image -boot order=d -drive file=disk_image,format=raw -enable-kvm -m 1024</code>
</pre>

<p>
To escape from Qemu app, press <code>Ctrl-Alt-G</code>.
</p>

<p>
Finally, run the system with
</p>
<pre class="example">
<code>qemu-system-x86_64 -enable-kvm -m 1024 disk_image</code>
</pre>

<p>
Alternatively, you can use <code>virt-manager</code> as a GUI front-end.
</p>

<p>
To have sound and better resolution:
</p>
<pre class="example">
<code>qemu-system-x86_64 -enable-kvm -m 4096 -vga virtio -soundhw hda -cpu host -smp 8 ubuntu</code>
</pre>

<p>
TODO: try SPICE.
</p>
</div>
</div>
</div>


<div id="outline-container-orga8574d0" class="outline-2">
<h2 id="orga8574d0"><span class="section-number-2">3</span> GuixSD</h2>
<div class="outline-text-2" id="text-3">
<p>
Actually the installation process is very joyful, except that no wifi
driver available.
</p>

<p>
Download the image and
</p>
<pre class="example">
<code>xz -d guixsd-install-0.14.0.system.iso.xz</code>
<code>dd if=guixsd-install-0.14.0.x86_64-linux.iso of=/dev/sdX</code>
<code>sync</code>
</pre>

<p>
Boot the system. The network interface can be seen via <code>ifconfig -a</code>
or <code>ip a</code>. You need to first bring the interface up:
</p>

<pre class="example">
<code>ifconfig interface up</code>
</pre>

<p>
Then get the IP address via
</p>
<pre class="example">
<code>dhclient -v interface</code>
</pre>

<p>
Then start the ssh daemon to continue install remotely (remember to
set password)
</p>

<pre class="example">
<code>herd start ssh-daemon</code>
</pre>

<p>
Partitioning the disk is the same for linux distributions. The
following is the setup for GPT.
</p>

<pre class="example">
<code>parted /dev/sda mklabel gpt</code>
<code>parted /dev/sda mkpart ESP fat32 1MiB 513MiB</code>
<code>parted /dev/sda set 1 boot on</code>
<code>parted /dev/sda mkpart primary linux-swap 513MiB 5GiB</code>
<code>parted /dev/sda mkpart primary ext4 5GiB 100%</code>
</pre>

<p>
Then, format the disks
</p>
<pre class="example">
<code>mkfs.fat -F32 /dev/sda1</code>
<code>mkfs.ext4 -L my-root /dev/sda2</code>
</pre>

<p>
The label here is important, because it can be used in the config
files, or the mount command below. Note that the ESP partition is
mounted on <code>/mnt/boot/efi</code>, instead of <code>/mnt/boot</code>. Actually there are
two suggested mount position for ESP partition on arch wiki, and
<code>/mnt/boot/efi</code> should be preferred.
</p>

<pre class="example">
<code>mount LABEL=my-root /mnt/</code>
<code>mkdir -p /mnt/boot/efi</code>
<code>mount /dev/sda1 /mnt/boot/efi</code>
</pre>

<p>
Then, start cow-store, making the /gnu/store copy-on-write
</p>

<pre class="example">
<code>herd start cow-store /mnt</code>
</pre>

<p>
Move the example configuration file into the target system. The
intention of the movement is that we will have that config file when
we reboot the system.
</p>

<pre class="example">
<code>mkdir /mnt/etc</code>
<code>cp /etc/configuration/desktop.scm /mnt/etc/config.scm</code>
<code>zile /mnt/etc/config.scm</code>
</pre>

<p>
When edit the file, we need to modify:
</p>
<ol class="org-ol">
<li>On legacy boot, make sure <code>grub-bootloader</code> to <code>/dev/sda</code>. On UEFI,
   it should be <code>grub-efi-bootloader</code> and <code>/mnt/boot/efi</code> (path to the
   mount point of ESP partition). The official manual says it should
   be <code>/boot/efi</code>, but mine shows error: "grub-install: error: failed
   to get canonical path of /boot/efi"</li>
<li>make sure <code>file-system</code> has the correct label and mount position</li>
<li>If you didn't use encryption, then you need to remove the mapped
   device section, also probably add <code>(title 'label)</code> as indicated
   <a href="https://www.gnu.org/software/guix/manual/html_node/Using-the-Configuration-System.html#Using-the-Configuration-System">here</a></li>
</ol>

<p>
Now install the system:
</p>
<pre class="example">
<code>guix system init /mnt/etc/config.scm /mnt/</code>
</pre>

<p>
The default config install a lot of things, including gnome, and takes
an hour. I should definitely maintain a copy of my config file.
</p>

<p>
Done. Reboot.
</p>

<p>
Whenever you want to update the system:
</p>
<pre class="example">
<code>guix pull</code>
<code>sudo -E guix system reconfigure</code>
<code>guix package -u</code>
<code>guix package -m manifest-file</code>
</pre>
</div>


<div id="outline-container-org6b30afd" class="outline-3">
<h3 id="org6b30afd"><span class="section-number-3">3.1</span> Qemu Image</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Running GuixSD in Qemu is probably the easiest way. Download the Qemu
image, uncompress it, and run:
</p>

<pre class="example">
<code>qemu-system-x86_64 \</code>
<code>   -net user -net nic,model=virtio \</code>
<code>   -enable-kvm -m 256 /path/to/image</code>
</pre>

<p>
To bring the network up:
</p>
<pre class="example">
<code>ifconfig eth0 up</code>
<code>dhclient -v eth0</code>
</pre>

<p>
The system is now online. But <code>ping</code> command is not working, and
that's fine.
</p>

<pre class="example">
<code>guix pull</code>
<code>guix package -u</code>
</pre>

<p>
The qemu image is 1.2G. To expand it, first expand the image size:
</p>

<pre class="example">
<code>qemu-img resize guixsd-vm-image-0.15.0.x86_64-linux  +10G</code>
</pre>

<p>
Boot the image
</p>

<pre class="example">
<code>qemu-system-x86_64 -net user -net nic,model=virtio -vga virtio -enable-kvm -m 2048 -cpu host -smp 8 guixsd-vm-image-0.15.0.x86_64-linux</code>
</pre>

<p>
The partition need not be umounted.
</p>

<pre class="example">
<code>fdisk /dev/sda</code>
<code>d 2</code>
<code>d 1 # note that this starts from 2048</code>
<code>n # create partition that starts also from 2048</code>
<code>a # check the boot flag</code>
<code>w # write</code>
</pre>

<p>
Then, reload the partition table:
</p>
<pre class="example">
<code>partprobe</code>
</pre>

<p>
Then resize the filesystem via <code>resize2fs</code>
</p>

<pre class="example">
<code>resize2fs /dev/sda</code>
</pre>

<p>
The image needs to connect internet.
</p>

<pre class="example">
<code>dhclient eth0</code>
</pre>

<p>
You are online. The <code>ping</code> command will not work, you can check
network with <code>guix download</code> command.
</p>

<p>
Installing <code>git</code> is not enough. It says certificate is needed. You
need probably <code>nss</code> and <code>nss-certs</code>. It also shows some environment
variables needed (how to show this information again? Are they really
belong to <code>nss</code> or <code>git</code>?)
</p>

<pre class="example">
<code>export GIT_SSL_CAINFO="/root/.guix-profile/etc/ssl/certs/ca-certificates.crt"</code>
<code>export GIT_EXEC_PATH="/root/.guix-profile/libexec/git-core"</code>
</pre>
</div>
</div>



<div id="outline-container-orgb3464e4" class="outline-3">
<h3 id="orgb3464e4"><span class="section-number-3">3.2</span> Guile</h3>
<div class="outline-text-3" id="text-3-2">
<p>
When debugging guile files, use <code>C-c C-s</code> to change to scheme to
<code>guile</code>, that would enable following definitions, otherwise it will
just complain "No geiser REPL for this buffer" even after <code>M-x
run-geiser</code>.
</p>
</div>
</div>

<div id="outline-container-orga1e2251" class="outline-3">
<h3 id="orga1e2251"><span class="section-number-3">3.3</span> Guix</h3>
<div class="outline-text-3" id="text-3-3">
<ul class="org-ul">
<li>guix package &#x2013;search-paths: show search path</li>
<li>guix channel: ???</li>

<li>A good reference: <a href="https://gitlab.com/pjotrp/guix-notes/">https://gitlab.com/pjotrp/guix-notes/</a></li>
<li>chromium package channel: <a href="https://gitlab.com/mbakke/guix-chromium">https://gitlab.com/mbakke/guix-chromium</a>
<ul class="org-ul">
<li>How to use this channel?? my guix pull is showing me this error:</li>
</ul></li>
</ul>

<pre class="example">
<code>guix pull: error: failed to load '/home/hebi/.config/guix/channels.scm':</code>
<code>system/base/compile.scm:144:21: In procedure compile-file:</code>
<code>failed to create path for auto-compiled file "/home/hebi/.config/guix/channels.scm"</code>
</pre>
</div>
</div>


<div id="outline-container-orgd856511" class="outline-3">
<h3 id="orgd856511"><span class="section-number-3">3.4</span> Developing Guix packages</h3>
<div class="outline-text-3" id="text-3-4">
<p>
To get the hash:
</p>
<pre class="example">
<code>git clone https://...</code>
<code>cd xxx</code>
<code>guix hash -rx .</code>
</pre>

<p>
It seems not necessary to switch to the last commit if using the last
commit. But the commit is needed anyway.
</p>
<pre class="example">
<code>git log | head -1 # show the first commit</code>
<code>git checkout c6e10a</code>
</pre>
</div>
</div>



<div id="outline-container-orgc8e97e9" class="outline-3">
<h3 id="orgc8e97e9"><span class="section-number-3">3.5</span> Bootloader</h3>
<div class="outline-text-3" id="text-3-5">
<pre class="example">
<code>/gnu/store/9nqaksx40zh5d6cg5rim3f3spy56bfb9-raw-initrd/initrd.cpio.gz</code>
</pre>
</div>
</div>

<div id="outline-container-org740d469" class="outline-3">
<h3 id="org740d469"><span class="section-number-3">3.6</span> Nvidia driver</h3>
<div class="outline-text-3" id="text-3-6">
<p>
To install Nvidia driver, we need to kernel source tree. However,
there is no such a package in Guix. Thus, we need to build the kernel
source first.
</p>

<pre class="example">
<code>guix build linux-libre --check --keep-failed</code>
</pre>

<p>
When <code>--check</code> and <code>--keep-failed</code> are used together, it builds the
package and keep it in <code>/tmp/guix-build-linux-libre-x.x.x.drv-0</code>.
</p>

<p>
After that, we can simply unpack the Nvidia driver:
</p>

<pre class="example">
<code>sh NVIDIA-Linux-x86_65-xxx.xx.run -x</code>
<code>cd NVIDIA-Linux-x86_64-xxx.xx</code>
</pre>

<p>
Note that you should use the same version of GCC, and <code>guix
environment</code> seems not to overwrite the gcc version. So say you need
gcc@7:
</p>

<pre class="example">
<code>guix package -i gcc@7</code>
</pre>

<p>
Run the build
</p>
<pre class="example">
<code>sudo ./nvidia-installer --kernel-source-path /tmp/guix-build-linux-libre-x.x.x.drv-0</code>
</pre>


<p>
It should build, and the kernel modules are in
<code>/lib/modules/4.20.7-gnu/video/</code>. However it won't be loaded
successfully, and the installer will complain:
</p>

<p>
#+BEGIN<sub>EXAMPL</sub>
Driver file installation is complete.
ERROR: Unable to load the 'nvidia-drm' kernel module.
#+END<sub>EXAMPLE</sub>
</p>

<p>
That's OK.  Guix has its own module load path, and the path is hard
coded by Linux source to be a single path. Thus, there is practically
no way to automatically load those modules. So just load them
manually. Thus the driver cannot be used as the X11 driver. But it is
OK to use for Tensorflow.
</p>

<pre class="example">
<code>modprobe ipmi_devintf</code>
<code>insmod /lib/modules/x.x.x-gnu/video/nvidia.ko</code>
<code>insmod /lib/modules/x.x.x-gnu/video/nvidia-modeset.ko</code>
<code>insmod /lib/modules/x.x.x-gnu/video/nvidia-drm.ko</code>
<code>insmod /lib/modules/x.x.x-gnu/video/nvidia-uvm.ko</code>
</pre>

<p>
Last but not least, you need to manually prevent kernel from loading
nouveau, i.e. in <code>config.scm</code>, you should have:
</p>

<pre class="example">
<code>(operating-system</code>
<code>  (kernel-arguments '("intel_iommu=on" "iommu=pt" "modprobe.blacklist=nouveau"))</code>
<code>  ..)</code>
</pre>
</div>
</div>


<div id="outline-container-org21549f5" class="outline-3">
<h3 id="org21549f5"><span class="section-number-3">3.7</span> Guix on Foreign distribution</h3>
<div class="outline-text-3" id="text-3-7">
</div>
<div id="outline-container-org4b117a6" class="outline-4">
<h4 id="org4b117a6"><span class="section-number-4">3.7.1</span> Trouble Shooting</h4>
<div class="outline-text-4" id="text-3-7-1">
<p>
On Ubuntu, every time I run <code>guix package</code>, I got the warning:
</p>
<pre class="example">
<code>guile: warning: failed to install locale</code>
<code>hint: Consider installing the `glibc-utf8-locales' or `glibc-locales' package and</code>
<code>defining `GUIX_LOCPATH', along these lines:</code>
<code></code>
<code>     guix package -i glibc-utf8-locales</code>
<code>     export GUIX_LOCPATH="$HOME/.guix-profile/lib/locale"</code>
<code></code>
<code>See the "Application Setup" section in the manual, for more info.</code>
</pre>

<p>
The problem is that, on Ubuntu, the guix-daemon is run as root. Thus,
the package and the path should be set to root's
profile. Specifically, in <code>/etc/systemd/system/guix-daemon.service</code>:
</p>

<pre class="example">
<code>Environment=GUIX_LOCPATH=/var/guix/profiles/per-user/root/guix-profile/lib/locale</code>
</pre>

<p>
The path is OK, but root does not have the package installed. Thus,
the following command fixes it. There is no need to update the guix of
the root.
</p>

<pre class="example">
<code>sudo guix package -i glibc-utf8-locales</code>
</pre>

<p>
Reference: <a href="https://lists.gnu.org/archive/html/help-guix/2019-01/msg00211.html">https://lists.gnu.org/archive/html/help-guix/2019-01/msg00211.html</a>
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-orgd21dbd2" class="outline-2">
<h2 id="orgd21dbd2"><span class="section-number-2">4</span> Git</h2>
<div class="outline-text-2" id="text-4">
<p>
Withdraw remote commit is actually fairly easy. First, reset local
commit, then force pushing.
</p>

<pre class="example">
<code>git reset --hard &lt;commit-hash&gt;</code>
<code>git push -f origin master</code>
</pre>

<p>
By contrast, <code>git-revert</code> will create a new commit to undo the
previous commits.
</p>

<p>
show the diff together when inspecting log
</p>
<pre class="example">
<code>git lg -p</code>
</pre>

<p>
Clone recursively for all submodules:
</p>

<pre class="example">
<code>git clone --recursive https://xxx</code>
</pre>

<p>
If you cloned without the recursive option, you can retrieve the
submodules by:
</p>

<pre class="example">
<code>git submodule update --init --recursive</code>
</pre>
</div>


<div id="outline-container-org8ad97cf" class="outline-3">
<h3 id="org8ad97cf"><span class="section-number-3">4.1</span> Configuration</h3>
<div class="outline-text-3" id="text-4-1">
<pre class="example">
<code>git config --global user.email 'xxx@xxx'</code>
<code>git config --global user.name 'xxx'</code>
<code>git config --global credential.helper cache # cache 15 min by default</code>
<code>git config --global credential.helper 'cache --timeout=3600' # set in sec</code>
</pre>
</div>
</div>

<div id="outline-container-orgd88d1b8" class="outline-3">
<h3 id="orgd88d1b8"><span class="section-number-3">4.2</span> Server</h3>
<div class="outline-text-3" id="text-4-2">
<p>
There are several protocols. The smart HTTP protocol seems to be the
way to go, because it supports both anonymous and authentication.
</p>

<p>
But local and SSH is easy. For local, you can just clone using the
<code>/abs/path/to/file</code> as URL. For ssh, use
<code>user@server:/path/to/proj.git</code>.
</p>

<p>
Now let me talk about setting up smart HTTP with lighttpd and cgit.
</p>

<p>
in <code>/etc/lighttpd/lighttpd.conf</code>
</p>

<pre class="example">
<code>server.port             = 80</code>
<code>server.username         = "http"</code>
<code>server.groupname        = "http"</code>
<code></code>
<code>server.document-root    = "/srv/http"</code>
<code></code>
<code>server.modules += ( "mod_auth", "mod_cgi", "mod_alias", "mod_setenv" )</code>
<code></code>
<code>alias.url += ( "/git" =&gt; "/usr/lib/git-core/git-http-backend" )</code>
<code>$HTTP["url"] =~ "^/git" {</code>
<code>  cgi.assign = ("" =&gt; "")</code>
<code>  setenv.add-environment = (</code>
<code>  "GIT_PROJECT_ROOT" =&gt; "/srv/git",</code>
<code>  "GIT_HTTP_EXPORT_ALL" =&gt; ""</code>
<code>  )</code>
<code>}</code>
<code>$HTTP["querystring"] =~ "service=git-receive-pack" {</code>
<code>        include "git-auth.conf"</code>
<code>}</code>
<code>$HTTP["url"] =~ "^/git/.*/git-receive-pack$" {</code>
<code>        include "git-auth.conf"</code>
<code>}</code>
<code></code>
<code># alias.url += ( "/cgit" =&gt; "/usr/share/webapps/cgit/cgit.cgi" )                                           </code>
<code># alias.url += ( "/cgit" =&gt; "/usr/lib/cgit/cgit.cgi" )                                                     </code>
<code>url.redirect += ("^/$" =&gt; "/cgit/")</code>
<code>$HTTP["url"] =~ "^/cgit" {</code>
<code>    server.document-root = "/usr/share/webapps"</code>
<code>    server.indexfiles = ("cgit.cgi")</code>
<code>    cgi.assign = ("cgit.cgi" =&gt; "")</code>
<code>    mimetype.assign = ( ".css" =&gt; "text/css" )</code>
<code>}</code>
</pre>

<p>
<code>/etc/lighttpd/git-auth.conf</code>
</p>

<pre class="example">
<code>auth.require = (</code>
<code>        "/" =&gt; (</code>
<code>                "method" =&gt; "basic",</code>
<code>                "realm" =&gt; "Git Access",</code>
<code>                "require" =&gt; "valid-user"</code>
<code>               )</code>
<code>)</code>
<code></code>
<code>auth.backend = "plain"</code>
<code>auth.backend.plain.userfile = "/etc/lighttpd-plain.user"</code>
</pre>

<p>
In <code>/etc/lighttpd-plain.user</code>
</p>
<pre class="example">
<code>hebi:myplainpassword</code>
</pre>

<p>
My <code>/etc/cgitrc</code>:
</p>
<pre class="example">
<code>#</code>
<code># cgit config</code>
<code>#</code>
<code></code>
<code># css=/cgit.css</code>
<code># logo=/cgit.png</code>
<code></code>
<code># Following lines work with the above Apache config</code>
<code>#css=/cgit-css/cgit.css</code>
<code>#logo=/cgit-css/cgit.png</code>
<code></code>
<code># Following lines work with the above Lighttpd config</code>
<code>css=/cgit/cgit.css</code>
<code>logo=/cgit/cgit.png</code>
<code></code>
<code># if you do not want that webcrawler (like google) index your site</code>
<code>robots=noindex, nofollow</code>
<code></code>
<code># if cgit messes up links, use a virtual-root. For example has cgit.example.org/ this value:</code>
<code># virtual-root=/cgit</code>
<code></code>
<code></code>
<code># Include some more info about example.com on the index page</code>
<code># root-readme=/var/www/htdocs/about.html</code>
<code>root-readme=/srv/http/index.html</code>
<code></code>
<code>#</code>
<code># List of repositories.</code>
<code># This list could be kept in a different file (e.g. '/etc/cgitrepos')</code>
<code># and included like this:</code>
<code>#   include=/etc/cgitrepos</code>
<code>#</code>
<code></code>
<code>clone-url=http://git.lihebi.com/git/$CGIT_REPO_URL.git</code>
<code>readme=:README.org</code>
<code>readme=:README.md</code>
<code>readme=:readme.md</code>
<code>readme=:README.mkd</code>
<code>readme=:readme.mkd</code>
<code>readme=:README.rst</code>
<code>readme=:readme.rst</code>
<code>readme=:README.html</code>
<code>readme=:readme.html</code>
<code>readme=:README.htm                                                                             </code>
<code>readme=:readme.htm                                                                             </code>
<code>readme=:README.txt                                                                             </code>
<code>readme=:readme.txt                                                                             </code>
<code>readme=:README                                                                                 </code>
<code>readme=:readme</code>
<code></code>
<code>section=hebi</code>
<code></code>
<code>repo.url=hebicc</code>
<code>repo.path=/srv/git/hebicc.git</code>
<code>repo.desc=Hebi CC</code>
<code></code>
<code>repo.url=cgit/hebicc</code>
<code>repo.path=/srv/git/hebicc.git</code>
<code>repo.desc=Hebi CC</code>
<code></code>
<code>repo.url=test</code>
<code>repo.path=/srv/git/test.git</code>
<code>repo.desc=Test</code>
<code></code>
<code>repo.url=pdf</code>
<code>repo.path=/srv/git/pdf.git</code>
<code>repo.desc=pdf</code>
<code></code>
<code></code>
<code># The next repositories will be displayed under the 'extras' heading</code>
<code>section=extras</code>
<code></code>
<code></code>
<code>repo.url=baz</code>
<code>repo.path=/pub/git/baz.git</code>
<code>repo.desc=a set of extensions for bar users</code>
<code></code>
<code>repo.url=wiz</code>
<code>repo.path=/pub/git/wiz.git</code>
<code>repo.desc=the wizard of foo</code>
<code></code>
<code></code>
<code>repo.url=foo</code>
<code>repo.path=/pub/git/foo.git</code>
<code>repo.desc=the master foo repository</code>
<code>repo.owner=fooman@example.com</code>
<code>repo.readme=info/web/about.html</code>
<code></code>
<code># Add some mirrored repositories</code>
<code>section=mirrors</code>
<code></code>
<code>repo.url=git</code>
<code>repo.path=/pub/git/git.git</code>
<code>repo.desc=the dscm</code>
<code></code>
<code># For a non-bare repository</code>
<code># repo.url=MyOtherRepo</code>
<code># repo.path=/srv/git/MyOtherRepo/.git</code>
<code># repo.desc=That's my other git repository</code>
<code></code>
<code># scan-path=/srv/git/</code>
</pre>

<p>
The <code>/srv/git</code> must be of group <code>http</code>, and the group write mask must
be set for push.
</p>


<p>
I can clone via <code>http://git.lihebi.com/git/repo.git</code>. The cgit page is
at <code>http://git.lihebi.com/cgit</code>.
</p>

<p>
In practice, I cannot push a lot of pdf files, it seems to be the
problem of lighttpd configuration for max body size, but haven't look
into that yet. Cloning does not have such problem though.
</p>

<pre class="example">
<code>If I don't have the Let's Encrypt certificate, I cannot use</code>
<code>https. Then, I can only clone, but not push via git-http-backend</code>
<code></code>
<code>/var/lib/certbot/renew-certificates may need to be run manually, if</code>
<code>the /etc/letsencrypt/live/example.com does not exist</code>
<code></code>
<code>But, my server is inside IASTATE, Let's Encrypt cannot find my IP</code>
<code>address. Thus, nothing can be done actually.</code>
</pre>
</div>

<div id="outline-container-orgda7308c" class="outline-4">
<h4 id="orgda7308c"><span class="section-number-4">4.2.1</span> <span class="todo TODO">TODO</span> gitolite</h4>
</div>
</div>

<div id="outline-container-org7180258" class="outline-3">
<h3 id="org7180258"><span class="section-number-3">4.3</span> Individual tools</h3>
<div class="outline-text-3" id="text-4-3">
</div>
<div id="outline-container-org43cc32d" class="outline-4">
<h4 id="org43cc32d"><span class="section-number-4">4.3.1</span> git-bisect</h4>
<div class="outline-text-4" id="text-4-3-1">
<p>
This command uses a binary search algorithm to find which commit in your project's history introduced a bug.
</p>

<ol class="org-ol">
<li>The initial input: the "good" and "bad" commit.</li>
<li>bisect select a commit, check it out, and ASK YOU whether it is good or bad.</li>
<li>iterate step 2</li>
</ol>
</div>

<div id="outline-container-org8428bec" class="outline-5">
<h5 id="org8428bec"><span class="section-number-5">4.3.1.1</span> start</h5>
<div class="outline-text-5" id="text-4-3-1-1">
<pre class="example">
<code>  $ git bisect start</code>
<code>  $ git bisect bad                 # Current version is bad</code>
<code>  $ git bisect good v2.6.13-rc2    # v2.6.13-rc2 is known to be good</code>
</pre>
</div>
</div>
<div id="outline-container-org7072cb2" class="outline-5">
<h5 id="org7072cb2"><span class="section-number-5">4.3.1.2</span> answer the question</h5>
<div class="outline-text-5" id="text-4-3-1-2">
<p>
Each time testing a commit, answer the question by:
</p>
<pre class="example">
<code>  $ git bisect good # or bad</code>
</pre>
</div>
</div>
<div id="outline-container-org66f86fd" class="outline-5">
<h5 id="org66f86fd"><span class="section-number-5">4.3.1.3</span> multiple good</h5>
<div class="outline-text-5" id="text-4-3-1-3">
<p>
If you know beforehand more than one good commit,
you can narrow the bisect space down by specifying all of the good commits immediately after the bad commit when issuing the bisect start command
</p>

<ul class="org-ul">
<li>v2.6.20-rc6 is bad</li>
<li>v2.6.20-rc4 and v2.6.20-rc1 are good</li>
</ul>
<pre class="example">
<code>  $ git bisect start v2.6.20-rc6 v2.6.20-rc4 v2.6.20-rc1 --</code>
</pre>
</div>
</div>
<div id="outline-container-orgabaa099" class="outline-5">
<h5 id="orgabaa099"><span class="section-number-5">4.3.1.4</span> run script</h5>
<div class="outline-text-5" id="text-4-3-1-4">
<p>
If you have a script that can tell if the current source code is good or bad, you can bisect by issuing the command:
</p>
<pre class="example">
<code>  $ git bisect run my_script arguments</code>
</pre>
</div>
</div>

<div id="outline-container-org75c847a" class="outline-5">
<h5 id="org75c847a"><span class="section-number-5">4.3.1.5</span> Some work flows</h5>
<div class="outline-text-5" id="text-4-3-1-5">
<p>
Automatically bisect a broken build between v1.2 and HEAD:
In this case, only find the one that cause compile failure.
</p>
<pre class="example">
<code>  $ git bisect start HEAD v1.2 --      # HEAD is bad, v1.2 is good</code>
<code>  $ git bisect run make                # "make" builds the app</code>
<code>  $ git bisect reset                   # quit the bisect session</code>
</pre>


<p>
Automatically bisect a test failure between origin and HEAD:
This time, use the <code>make test</code> work flow
</p>
<pre class="example">
<code>  $ git bisect start HEAD origin --    # HEAD is bad, origin is good</code>
<code>  $ git bisect run make test           # "make test" builds and tests</code>
<code>  $ git bisect reset                   # quit the bisect session</code>
</pre>

<p>
Automatically bisect a broken test case:
Use a custom script.
</p>
<pre class="example">
<code>  $ cat ~/test.sh</code>
<code>  #!/bin/sh</code>
<code>  make || exit 125                     # this skips broken builds</code>
<code>  ~/check_test_case.sh                 # does the test case pass?</code>
<code>  $ git bisect start HEAD HEAD~10 --   # culprit is among the last 10</code>
<code>  $ git bisect run ~/test.sh</code>
<code>  $ git bisect reset                   # quit the bisect session</code>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3bd611f" class="outline-4">
<h4 id="org3bd611f"><span class="section-number-4">4.3.2</span> git-blame</h4>
<div class="outline-text-4" id="text-4-3-2">
<p>
Annotates each line in the given file with information from the revision which last modified the line.
</p>
</div>
</div>
</div>
</div>





<div id="outline-container-org88ff240" class="outline-2">
<h2 id="org88ff240"><span class="section-number-2">5</span> Network</h2>
<div class="outline-text-2" id="text-5">
<p>
When using docker container, host system cannot resolve the name of
container to the specific IP. I have to specify it manually. To
resolve a name to IP address, you can add it into
<code>/etc/hosts</code>. E.g. at the end of the file, add:
</p>

<pre class="example">
<code>172.18.0.2 srcml-server-container</code>
</pre>

<p>
In Arch, <code>ifconfig</code> is in <code>net-tools</code> package, and is deprecated. Use
<code>ip</code> instead:
</p>

<pre class="example">
<code>ip addr show &lt;dev&gt;</code>
<code>ip link # show links</code>
<code>ip link show &lt;dev&gt;</code>
</pre>

<p>
To kill apps listening on a port, use <code>sudo fuser -k 8080/tcp</code>.
</p>
</div>

<div id="outline-container-orgcb8fc1a" class="outline-3">
<h3 id="orgcb8fc1a"><span class="section-number-3">5.1</span> SSH</h3>
<div class="outline-text-3" id="text-5-1">
<p>
Dropbear is a replacement of OpenSSH.
</p>

<p>
To set up RSA login:
</p>
<pre class="example">
<code># generate ~/.ssh/id_rsa and ~/.ssh/id_rsa.pub</code>
<code>ssh-keygen</code>
<code># copy RSA to remote</code>
<code>ssh-copy-id user@host</code>
</pre>

<p>
This will put the content of the public key onto the server's
<code>~/.ssh/authorized_keys</code>. Which is to say, you can do the same thing
manually:
</p>

<pre class="example">
<code>cat ~/.ssh/id_rsa.pub | ssh user@host "cat &gt;&gt; .ssh/authorized_keys"</code>
</pre>


<p>
In <code>~/.ssh/config</code>, you can actually set up alias for remote
host. Then you will use that alias in place of <code>user@host</code>.
</p>

<pre class="example">
<code>host remarkable</code>
<code>     Hostname 10.11.99.1</code>
<code>     User root</code>
</pre>

<p>
A side note: remarkable password can be changed by editing
<code>/etc/remarkable.conf</code> and a reboot.
</p>
</div>
</div>

<div id="outline-container-org07bd8e5" class="outline-3">
<h3 id="org07bd8e5"><span class="section-number-3">5.2</span> Wireless Networking</h3>
<div class="outline-text-3" id="text-5-2">
<p>
DHCP is not enabled by default. It is the philloshophy for Arch:
installing a package will not enable any service. Enable it by;
</p>

<pre class="example">
<code>systemctl enable dhcpcd</code>
</pre>

<p>
The utility for configuring wireless network is called <code>iw</code>.
</p>
<ul class="org-ul">
<li>iw dev: list dev</li>
<li>iw dev &lt;interface&gt; link: show status</li>
<li>ip link set &lt;interface&gt; up: up the interface</li>
<li>ip link show &lt;interface&gt;: if you see &lt;UP&gt; in the output, the interface is up</li>
<li>iw dev interface scan: scan for network</li>
<li>iw dev &lt;interface&gt; connect "SSID": connect to open network</li>
</ul>

<p>
<code>iw</code> can only connect to public network. <code>wpa_supplicant</code> is used to
connect WPA2/WEP encrypted network.
</p>

<p>
The config file (e.g. <code>/etc/wpa_supplicant/example.conf</code>) can be
generated in two ways: using <code>wpa_cli</code> or <code>use wpa_passphrase</code>.
<code>wpa_cli</code> is interactive, and has commands <code>scan</code>, <code>add_network</code>,
<code>save_config</code>.
</p>

<pre class="example">
<code>wpa_passphrase MYSSID &lt;passphrase&gt; &gt; /path/to/example.conf</code>
</pre>

<p>
Inside this file, there's a network section. The <code>ssid</code> is a quoted
SSID name, while <code>psk</code> is unquoted encrypted phrase. The psk can also
be quoted clear password.  If the network is open, you can use
<code>key_mgmt=NONE</code> in place of <code>psk</code>
</p>

<p>
After the configuration, you can actually connect to a WPA/WEP
protected network, where 
</p>

<pre class="example">
<code>wpa_supplicant -B -i &lt;interface&gt; -c &lt;(wpa_passphrase &lt;MYSSID&gt; &lt;passphrase&gt;)</code>
</pre>

<p>
connect to a 
</p>
<ul class="org-ul">
<li>-b: fork into background</li>
<li>-i interface</li>
<li>-c: path to configuration file.</li>
</ul>

<p>
Alternatively, you can use the config file
</p>
<pre class="example">
<code>wpa_supplicant -B -i &lt;interface&gt; -c /path/to/example.conf</code>
</pre>

<p>
After this, you need to get IP address by the "usual" way, e.g.
</p>
<pre class="example">
<code>dhcpcd &lt;interface&gt;</code>
</pre>

<p>
It seems that we should enable the service:
</p>
<ul class="org-ul">
<li>wpa<sub>supplicant</sub>@&lt;interface&gt;</li>
<li>dhcpcd@&lt;interface&gt;</li>
</ul>

<p>
Also, dhcpcd has a hook that can launch wpa<sub>supplicant</sub> implicitly.
</p>

<p>
To Sum Up, find the interface by <code>iw dev</code>. Say it is <code>wlp4s0</code>.
</p>

<p>
Create config file <code>/etc/wpa_supplicant/wpa_supplicant-wlp4s0.conf</code>:
</p>

<pre class="example">
<code>  network={</code>
<code>          ssid="MYSSID"</code>
<code>          psk="clear passwd"</code>
<code>          psk=fjiewjilajdsf8345j38osfj</code>
<code>  }</code>
<code></code>
<code>  network={</code>
<code>          ssid="2NDSSID"</code>
<code>          key_mgmt=NONE</code>
<code>  }</code>
</pre>

<p>
Enable <code>wpa_supplicant@wlp4s0</code> and <code>dhcpcd@wlp4s0</code> (or just <code>dhcpcd</code>)
</p>


<p>
To change another wifi, kill the server and use another one
</p>
<pre class="example">
<code>sudo killall wpa_supplicant</code>
<code>wpa_supplicant -B -i wlp4s0 -c /path/to/wifi.conf</code>
</pre>
</div>
</div>



<div id="outline-container-orgb410763" class="outline-3">
<h3 id="orgb410763"><span class="section-number-3">5.3</span> VPN</h3>
<div class="outline-text-3" id="text-5-3">
</div>
<div id="outline-container-orga2a0967" class="outline-4">
<h4 id="orga2a0967"><span class="section-number-4">5.3.1</span> L2tp, IPSec</h4>
<div class="outline-text-4" id="text-5-3-1">
<pre class="example">
<code>apt-get purge "lxc-docker*"</code>
<code>apt-get purge "docker.io*"</code>
<code>apt-get update</code>
<code>apt-get install apt-transport-https ca-certificates gnupg2</code>
<code>sudo apt-key adv \</code>
<code>       --keyserver hkp://ha.pool.sks-keyservers.net:80 \</code>
<code>       --recv-keys 58118E89F3A912897C070ADBF76221572C52609D</code>
<code></code>
</pre>

<pre class="example">
<code>deb https://apt.dockerproject.org/repo debian-jessie main</code>
</pre>

<pre class="example">
<code>apt-get update</code>
<code>apt-cache policy docker-engine</code>
<code>apt-get update</code>
<code>apt-get install docker-engine</code>
<code>service docker start</code>
<code>docker run hello-world</code>
<code></code>
</pre>

<p>
<a href="https://github.com/hwdsl2/setup-ipsec-vpn/blob/master/docs/clients.md">https://github.com/hwdsl2/setup-ipsec-vpn/blob/master/docs/clients.md</a>
<a href="https://hub.docker.com/r/fcojean/l2tp-ipsec-vpn-server/">https://hub.docker.com/r/fcojean/l2tp-ipsec-vpn-server/</a>
</p>

<pre class="example">
<code>docker pull fcojean/l2tp-ipsec-vpn-server</code>
<code></code>
</pre>

<p>
vpn.env
</p>

<pre class="example">
<code>VPN_IPSEC_PSK=&lt;IPsec pre-shared key&gt;</code>
<code>VPN_USER_CREDENTIAL_LIST=[{"login":"userTest1","password":"test1"},{"login":"userTest2","password":"test2"}]</code>
</pre>

<pre class="example">
<code>modprobe af_key</code>
<code>docker run \</code>
<code>    --name l2tp-ipsec-vpn-server \</code>
<code>    --env-file ./vpn.env \</code>
<code>    -p 500:500/udp \</code>
<code>    -p 4500:4500/udp \</code>
<code>    -v /lib/modules:/lib/modules:ro \</code>
<code>    -d --privileged \</code>
<code>    fcojean/l2tp-ipsec-vpn-server</code>
</pre>

<pre class="example">
<code>docker logs l2tp-ipsec-vpn-server</code>
<code>docker exec -it l2tp-ipsec-vpn-server ipsec status</code>
</pre>
</div>
</div>

<div id="outline-container-orgebaa42f" class="outline-4">
<h4 id="orgebaa42f"><span class="section-number-4">5.3.2</span> OpenVPN</h4>
<div class="outline-text-4" id="text-5-3-2">
</div>
<div id="outline-container-org4d2a118" class="outline-5">
<h5 id="org4d2a118"><span class="section-number-5">5.3.2.1</span> Server Setup</h5>
<div class="outline-text-5" id="text-5-3-2-1">
<p>
<a href="https://github.com/kylemanna/docker-openvpn">https://github.com/kylemanna/docker-openvpn</a>
It is very interesting to use docker this way.
</p>

<p>
The persisit is the storage, which is mounted on /etc/openvpn, serving
as the configuration.  Each time, create a new docker container
mounting the same storage. Each step write to the configuration.
</p>

<pre class="example">
<code>OVPN_DATA="ovpn-data-example"</code>
<code>docker volume create --name $OVPN_DATA</code>
<code>docker run -v $OVPN_DATA:/etc/openvpn --rm kylemanna/openvpn ovpn_genconfig -u udp://VPN.SERVERNAME.COM</code>
<code>docker run -v $OVPN_DATA:/etc/openvpn --rm -it kylemanna/openvpn ovpn_initpki</code>
</pre>

<p>
It is easy to run the server itself. This time use -d option to make
it a daemon.
</p>
<pre class="example">
<code>docker run -v $OVPN_DATA:/etc/openvpn -d -p 1194:1194/udp --cap-add=NET_ADMIN kylemanna/openvpn</code>
</pre>

<p>
It is also easy to create certificate on-the-go. For that, create new
container to create and retrieve the certificate.
</p>

<pre class="example">
<code>docker run -v $OVPN_DATA:/etc/openvpn --rm -it kylemanna/openvpn easyrsa build-client-full CLIENTNAME nopass</code>
<code>docker run -v $OVPN_DATA:/etc/openvpn --rm kylemanna/openvpn ovpn_getclient CLIENTNAME &gt; CLIENTNAME.ovpn</code>
</pre>
</div>
</div>

<div id="outline-container-org3ac8051" class="outline-5">
<h5 id="org3ac8051"><span class="section-number-5">5.3.2.2</span> Client Setup</h5>
<div class="outline-text-5" id="text-5-3-2-2">
<p>
On arch, copy hebi.ovpn to /etc/openvpn/client/hebi.conf. Then the
service openvpn-client@hebi will be available for systemd. On ubuntu,
the path is /etc/openvpn/hebi.conf, with service openvpn@hebi.
Start the service will forward traffic.
</p>

<p>
It is likely that you can connect, can ping any IP address, but cannot
resolve names. You can even use <code>drill @8.8.8.8 google.com</code> to resolve
the name on the way.
</p>

<p>
The trick is to push resolv conf of local machine to remote. First
install <code>openresolv</code> and (aur) <code>openvpn-update-resolv-conf</code>. Add the
following to the end of hebi.conf file:
</p>

<pre class="example">
<code>script-security 2</code>
<code>up /etc/openvpn/update-resolv-conf</code>
<code>down /etc/openvpn/update-resolv-conf</code>
</pre>

<p>
For ubuntu the openvpn package already contains the file. Just modify
the conf file.
</p>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-org6b18a87" class="outline-2">
<h2 id="org6b18a87"><span class="section-number-2">6</span> App</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-orgf6ddbbc" class="outline-3">
<h3 id="orgf6ddbbc"><span class="section-number-3">6.1</span> mplayer</h3>
<div class="outline-text-3" id="text-6-1">
<p>
Interactive controls:
</p>
<ul class="org-ul">
<li>Forward/Backward: LEFT/RIGHT (10s), UP/DOWN (1m), PGUP/PGDWN (10m)</li>
<li>Playback speed: <code>[]</code> (10%), <code>{}</code> (50%), backspace (reset)</li>
<li><code>/*</code>: volume</li>
</ul>

<p>
When changing the speed, the pitch changed. To disable this, start
mplayer by <code>mplayer -af scaletempo</code>.  To stretch the images to full
screen, pass the <code>-zoom</code> option when starting.
</p>
</div>
</div>

<div id="outline-container-org71f7dcc" class="outline-3">
<h3 id="org71f7dcc"><span class="section-number-3">6.2</span> youtube-dl</h3>
<div class="outline-text-3" id="text-6-2">
<p>
When downloading a playlist, you can make the template to number the
files
</p>
<pre class="example">
<code>youtube-dl -o "%(playlist_index)s-%(title)s.%(ext)s" &lt;playlist_link&gt;</code>
</pre>

<p>
Download music only:
</p>
<pre class="example">
<code>youtube-dl --extract-audio --audio-format flac &lt;url&gt;</code>
</pre>
</div>
</div>

<div id="outline-container-org29bf693" class="outline-3">
<h3 id="org29bf693"><span class="section-number-3">6.3</span> chrome extensions</h3>
<div class="outline-text-3" id="text-6-3">
<ul class="org-ul">
<li><code>html5outliner</code>: give you a toc of the page. VERY NICE!</li>
<li id="<code>markdown here</code>">render for email</li>
<li><code>unblockyouku</code></li>
<li><code>adblock</code></li>
<li id="<code>sight</code> &amp; <code>syntaxtic</code>">syntax highlighter</li>
</ul>
</div>
</div>


<div id="outline-container-org98c9b0b" class="outline-3">
<h3 id="org98c9b0b"><span class="section-number-3">6.4</span> Remove viewer</h3>
<div class="outline-text-3" id="text-6-4">
<p>
The lab machines are accessed via spice. The client for spice is
virt-viewer. It can be installed through package manager. The actual
client is called remote-viewer, which is shipped with virt-viewer. So
the command to connect to the .vv file: <code>remove-viewer console.vv</code>.
</p>
</div>
</div>

<div id="outline-container-org0c050c1" class="outline-3">
<h3 id="org0c050c1"><span class="section-number-3">6.5</span> mpd</h3>
<div class="outline-text-3" id="text-6-5">
<p>
music play daemon
</p>

<p>
To start:
</p>
<pre class="example">
<code>mkdir -p ~/.config/mpd</code>
<code>cp /usr/share/doc/mpd/mpdconf.example ~/.config/mpd/mpd.conf</code>
<code>mkdir ~/.mpd/playlists</code>
</pre>

<pre class="example">
<code># Required files</code>
<code>db_file            "~/.mpd/database"</code>
<code>log_file           "~/.mpd/log"</code>
<code></code>
<code># Optional</code>
<code>music_directory    "~/music"</code>
<code>playlist_directory "~/.mpd/playlists"</code>
<code>pid_file           "~/.mpd/pid"</code>
<code>state_file         "~/.mpd/state"</code>
<code>sticker_file       "~/.mpd/sticker.sql"</code>
<code></code>
<code># uncomment pulse audio section</code>
<code>audio_output {</code>
<code>	type		"pulse"</code>
<code>	name		"My Pulse Output"</code>
<code>}</code>
</pre>

<p>
Start mpd by:
</p>
<pre class="example">
<code>systemctl --user start mpd</code>
<code>systemctl --user enable mpd</code>
</pre>

<p>
The client cantata can be used to create list. stumpwm-contrib has a
mpd client. mpc is a command line client.
</p>
</div>
</div>


<div id="outline-container-orgd66546f" class="outline-3">
<h3 id="orgd66546f"><span class="section-number-3">6.6</span> fontforge</h3>
<div class="outline-text-3" id="text-6-6">
<p>
How I made the WenQuanYi Micro Hei ttf font (clx-truetype only
recognizes ttf, not ttc):
</p>

<ul class="org-ul">
<li>input: ttc file</li>
<li>Tool: fontforge</li>
</ul>

<p>
Open ttc file, select one, generate font, choose truetype
The validation failed, but doesn't matter
</p>
</div>
</div>

<div id="outline-container-org9252643" class="outline-3">
<h3 id="org9252643"><span class="section-number-3">6.7</span> tmux</h3>
<div class="outline-text-3" id="text-6-7">
<div class="org-src-container">
<pre class="src src-shell"><code><span class="org-comment-delimiter"># </span><span class="org-comment">start a new session, with the session name set to "helium"</span></code>
<code>tmux new -s helium</code>
<code><span class="org-comment-delimiter"># </span><span class="org-comment">attach, and the target is "helium"</span></code>
<code>tmux a -t helium</code>
</pre>
</div>


<p>
Some default commands (all after prefix key):
</p>
<ul class="org-ul">
<li>!: break the current pane into another window</li>
<li><code>:</code>: prompt command</li>
<li>q: briefly display pane index (1,2,etc)</li>
</ul>


<p>
Commands
</p>
<ul class="org-ul">
<li>select-layout even-horizontal: balance window horizontally</li>
<li>last-window: jump to last active window</li>
<li>new-window</li>
<li>detach</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org41e6780" class="outline-2">
<h2 id="org41e6780"><span class="section-number-2">7</span> Window System</h2>
<div class="outline-text-2" id="text-7">
<p>
X generally distinguishes between two types of selection, the PRIMARY
and the CLIPBOARD. Every time you select a piece of text with the
mouse, the selected text is set as the PRIMARY selection. Using the
copy function will place the selected text into the CLIPBOARD. Pasting
using the middle mouse button will insert the PRIMARY selection,
pasting using the paste function will insert the CLIPBOARD.
</p>
</div>


<div id="outline-container-org24999b2" class="outline-3">
<h3 id="org24999b2"><span class="section-number-3">7.1</span> xkill</h3>
<div class="outline-text-3" id="text-7-1">
<p>
Kill all Xorg instances
</p>
<pre class="example">
<code>pkill -15 Xorg</code>
</pre>

<p>
If using kill:
</p>
<pre class="example">
<code>ps -ef | grep Xorg # find the pid</code>
<code>kill -9 &lt;PID&gt;</code>
</pre>

<p>
The xkill is not working properly, giving me "unable to find display"
error.
</p>
</div>
</div>

<div id="outline-container-org2e1a57c" class="outline-3">
<h3 id="org2e1a57c"><span class="section-number-3">7.2</span> Display Manager</h3>
<div class="outline-text-3" id="text-7-2">
<p>
Install xdm. It will use the file <code>$HOME/.xsession</code>, so
</p>
<pre class="example">
<code>ln -s $HOME/.xinitrc $HOME/.xsession</code>
</pre>

<p>
Change default desktop environment:
</p>
<ul class="org-ul">
<li>GNome: gdm</li>
<li>KDE: kdm</li>
<li>lxfe: lightdm</li>
</ul>

<p>
Change (three approaches):
</p>
<ol class="org-ol">
<li>edit <code>/etc/X11/default-display-manager</code>: I think we'd better use update-alternative</li>
<li><code>sudo dpkg-reconfigure gdm</code></li>
<li><code>update-alternatives --config x-window-manage</code></li>
</ol>
</div>
</div>
<div id="outline-container-org427169c" class="outline-3">
<h3 id="org427169c"><span class="section-number-3">7.3</span> screen</h3>
<div class="outline-text-3" id="text-7-3">
<p>
Multi screen, stumpwm detect as one.  Install <code>xdpyinfo</code>. It is used
to detect the heads.
</p>

<p>
check the screen resolution:
</p>
<pre class="example">
<code>xdpyinfo | grep -B 2 resolution</code>
</pre>

<p>
Multiple Display:
</p>

<pre class="example">
<code># Mirror display</code>
<code>sudo xrandr --output HDMI-2 --same-as eDP-1</code>
<code>sudo xrandr --output HDMI-2 --off</code>
</pre>

<p>
Rotate
</p>
<pre class="example">
<code>xrandr --output HDMI-1 --rotate left</code>
</pre>

<p>
Chagne resolution
</p>
<pre class="example">
<code>xrandr --output HDMI-1 --mode 1920x1080</code>
</pre>

<p>
Touch screen might need calibration in dual screen setup. Simply find
the touch screen device ID (e.g. 10) from <code>xinput</code> and screen ID
(e.g. DP-1) from <code>xrandr</code>, and execute:
</p>

<pre class="example">
<code>xinput map-to-output &lt;device-id&gt; &lt;screen-id&gt;</code>
</pre>
</div>
</div>


<div id="outline-container-orgbd11c7a" class="outline-3">
<h3 id="orgbd11c7a"><span class="section-number-3">7.4</span> cursor</h3>
<div class="outline-text-3" id="text-7-4">
<p>
Install xcursor-themes:
</p>
<pre class="example">
<code>aptitude install xcursor-themes</code>
<code>aptitude show xcursor-themes # here it will output the themes name</code>
</pre>

<p>
In <code>.Xresources</code>:
</p>
<pre class="example">
<code>Xcursor.theme: redglass</code>
</pre>
</div>
</div>

<div id="outline-container-org03abdaf" class="outline-3">
<h3 id="org03abdaf"><span class="section-number-3">7.5</span> Natural Scrolling</h3>
<div class="outline-text-3" id="text-7-5">
<p>
The old solution is to swap the pointer button "4" and "5", by
<code>xmodmap</code> or <code>xinput</code>:
</p>

<pre class="example">
<code>xmodmap -e "pointer = 1 2 3 4 5"</code>
<code>xinput --set-button-map 10 1 2 3 5 4</code>
</pre>

<p>
The 10 is the id, to find it out, run xinput without argument.
</p>

<p>
But this way is deprecated, as of chromium 49 and above, it does not work any more.
So use the xinput way to <i>set the property</i>:
</p>

<pre class="example">
<code>xinput set-prop 10 "libinput Natural Scrolling Enabled" 1</code>
</pre>

<p>
I'm using logitech G900 and the property might be different. It works!
</p>

<p>
Not sure if the xinput command should be run each time the system
boots. That would be hard for specifying ID.
</p>

<p>
The detail is, you can do this:
</p>

<pre class="example">
<code>xinput # show a list of devices</code>
<code>xinput list-props &lt;ID&gt; # list of properties</code>
<code>xinput set-prop &lt;deviceID&gt; &lt;propID&gt; &lt;value&gt;</code>
</pre>
</div>
</div>

<div id="outline-container-orgefa6bfa" class="outline-3">
<h3 id="orgefa6bfa"><span class="section-number-3">7.6</span> ratpoison</h3>
<div class="outline-text-3" id="text-7-6">
<p>
This is actually a wonderful WM.  To start:
</p>

<pre class="example">
<code>aptitude install ratpoison</code>
</pre>

<p>
In <code>.xinitrc</code>:
</p>

<pre class="example">
<code>exec ratpoison</code>
</pre>

<ul class="org-ul">
<li><code>C-t ?</code> to show the help</li>
</ul>

<p>
actually <code>C-t</code> is the prefix of every command, <code>C-g</code> to abort.
</p>
<ul class="org-ul">
<li><code>C-t :</code>: type command</li>
<li><code>C-t !</code>: run shell command</li>
<li><code>C-t .</code>: open menu</li>
<li><code>C-t c</code>: open terminal</li>
</ul>


<p>
HOWEVER, this is pretty old, and it cause the screen to go brighter
and darker back and force.  Fortunately the stumpwm is very like this
one, but
</p>
<ol class="org-ol">
<li>actively maintained on github.</li>
<li>written in common lisp</li>
</ol>
</div>
</div>



<div id="outline-container-orgc820ed2" class="outline-3">
<h3 id="orgc820ed2"><span class="section-number-3">7.7</span> StumpWM</h3>
<div class="outline-text-3" id="text-7-7">
</div>
<div id="outline-container-orgf639569" class="outline-4">
<h4 id="orgf639569"><span class="section-number-4">7.7.1</span> Installation</h4>
<div class="outline-text-4" id="text-7-7-1">
<p>
In order to use <code>ttf-fonts</code> module, the lisp <code>clx-truetype</code> package needs to be installed.
Install the slime IDE for emacs, install quicklisp, then install it using quicklisp.
Follow the description in lisp wiki page.
</p>
</div>

<div id="outline-container-org98ed20d" class="outline-5">
<h5 id="org98ed20d"><span class="section-number-5">7.7.1.1</span> A better way to install stumpwm</h5>
<div class="outline-text-5" id="text-7-7-1-1">
<ul class="org-ul">
<li>This seems a better way to install stumpwm <code>(ql:quickload
  "stumpwm")</code></li>
</ul>
<p>
But this require the .xinitrc to be
</p>
<pre class="example">
<code>exec sbcl --load /path/to/startstump</code>
</pre>
<p>
with startstump
</p>
<pre class="example">
<code>(require :stumpwm)</code>
<code>(stumpwm:stumpwm)</code>
</pre>

<p>
When using gdm, for example on Ubuntu, the default <code>Xsession</code> is
<code>/etc/gdm3/Xsession</code>. To add stumpwm into the entry, create
<code>/usr/share/xsessions/stumpwm.desktop</code> with:
</p>

<pre class="example">
<code>[Desktop Entry]</code>
<code>Encoding=UTF-8</code>
<code>Name=Stumpwm</code>
<code>Comment=Tiling, keyboard driven Common Lisp window manager</code>
<code>TryExec=stumpwm</code>
<code>Exec=stumpwm</code>
<code>Type=Application</code>
<code></code>
<code>[X-Window Manager]</code>
<code>SessionManaged=true</code>
</pre>

<p>
Of course this require the <code>/usr/bin/stumpwm</code> to be executable with
</p>

<pre class="example">
<code>#!/bin/sh</code>
<code>sbcl --load /path/to/startstump</code>
</pre>
</div>
</div>

<div id="outline-container-orgedfbd02" class="outline-5">
<h5 id="orgedfbd02"><span class="section-number-5">7.7.1.2</span> Live Debugging</h5>
<div class="outline-text-5" id="text-7-7-1-2">
<p>
To debug it live, you might need this in .stumpwmrc:
</p>
<div class="org-src-container">
<pre class="src src-lisp"><code>  (<span class="org-keyword">in-package</span> <span class="org-builtin">:stumpwm</span>)</code>
<code></code>
<code>  (<span class="org-keyword">require</span> <span class="org-constant">:swank</span>)</code>
<code>  (swank-loader:init)</code>
<code>  (swank:create-server <span class="org-builtin">:port</span> 4004</code>
<code>                       <span class="org-builtin">:style</span> swank:*communication-style*</code>
<code>                       <span class="org-builtin">:dont-close</span> t)</code>
</pre>
</div>

<p>
The above wont work unless swank is installed:
</p>
<pre class="example">
<code>(ql:quickload "swank")</code>
</pre>

<p>
The port is actually interesting. Here it is set to 4004, and the
slime in Emacs defaults to 4005, thus they wont mess up. The trick to
connect to stumpwm is to use <code>slime-connect</code> and put 4004 for the port
prompt.
</p>

<p>
So acutally if you just want to live debug, just install swank and
</p>
<pre class="example">
<code>(require 'swank)</code>
<code>(swank:create-server)</code>
</pre>

<p>
Note lastly that to install using quickload, you need permission. So
</p>

<pre class="example">
<code>sudo sbcl --load /usr/lib/quicklisp/setup</code>
</pre>

<p>
To test if it works, you should be able to switch to stumpwm namespace
and operate the window, like this:
</p>

<pre class="example">
<code>(in-package :stumpwm)</code>
<code>(stumpwm:select-window-by-number 2)</code>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0be3fac" class="outline-4">
<h4 id="org0be3fac"><span class="section-number-4">7.7.2</span> General</h4>
<div class="outline-text-4" id="text-7-7-2">
<p>
Same as ratpoison:
</p>
<ul class="org-ul">
<li><code>C-t C-h</code>: show help</li>
<li><code>C-t !</code>: run shell command</li>
<li><code>C-t c</code> terminal</li>
<li><code>C-t e</code>: open emacs!</li>
<li><code>C-t ;</code>: type a command</li>
<li><code>C-t :</code>: eval</li>
<li><code>C-t C-g</code>: abort</li>
<li><code>C-t a</code>: display time</li>
<li><code>C-t t</code>: send C-t</li>
<li><code>C-t m</code>: display last message</li>
</ul>
</div>

<div id="outline-container-org7ef2754" class="outline-5">
<h5 id="org7ef2754"><span class="section-number-5">7.7.2.1</span> Get Help</h5>
<div class="outline-text-5" id="text-7-7-2-1">
<ul class="org-ul">
<li><code>C-t h k</code>: from key binding to command: <code>describe-key</code></li>
<li><code>C-t h w</code>: from command to key binding: <code>where-is</code></li>
<li><code>C-t h c</code>: describe command</li>
<li><code>C-t h f</code>: describe function</li>
<li><code>C-t h v</code>: describe variable</li>

<li><code>mode-line</code>: start mode-line</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org98ea764" class="outline-4">
<h4 id="org98ea764"><span class="section-number-4">7.7.3</span> Window</h4>
<div class="outline-text-4" id="text-7-7-3">
<ul class="org-ul">
<li><code>C-t n</code></li>
<li><code>C-t p</code></li>
<li><code>C-t &lt;double-quote&gt;</code></li>
<li><code>C-t w</code> list all windows</li>
<li><code>C-t k</code> kill current frame (K to force quit)</li>
<li><code>C-t #</code> toggle mark of current window</li>
</ul>
</div>
</div>


<div id="outline-container-org74ddbce" class="outline-4">
<h4 id="org74ddbce"><span class="section-number-4">7.7.4</span> Frame</h4>
<div class="outline-text-4" id="text-7-7-4">
<ul class="org-ul">
<li><code>C-t s</code>: hsplit</li>
<li><code>C-t S</code>: vsplit</li>
<li><code>C-t Q</code>: kill other frames, only retains this one</li>
<li><code>C-t r</code>: resize, can use <code>C-n</code>, <code>C-p</code> interactively</li>
<li><code>C-t +</code>: balance frame</li>
<li><code>C-t o</code>: next frame</li>
<li><code>C-t -</code>: show desktop</li>
</ul>

<p>
Other commands
</p>
<dl class="org-dl">
<dt><code>remove-split</code></dt><dd>to remove the current frame</dd>
<dt><code>fclear</code></dt><dd>clear the current frame, show the desktop</dd>
</dl>

<p>
To resize frames interactively, <code>C-t r</code> and then use the arrows.
</p>
</div>
</div>

<div id="outline-container-orge5eb477" class="outline-4">
<h4 id="orge5eb477"><span class="section-number-4">7.7.5</span> Groups</h4>
<div class="outline-text-4" id="text-7-7-5">
<p>
Shortcuts:
</p>
<ul class="org-ul">
<li><code>C-t g c</code>: create: <code>gnew</code>. Also available for float: <code>gnew-float</code></li>
<li><code>C-t g n</code>: next</li>
<li><code>C-t g o</code>: <code>gother</code></li>
<li><code>C-t g p</code>: previous</li>
<li><code>C-t g &lt;double-quote&gt;</code>: interactively select groups: <code>grouplist</code></li>
<li><code>C-t g k</code>: kill current group, move windows to next group: <code>gkill</code></li>
<li><code>C-t g r</code>: rename current group: <code>grename</code></li>
<li><code>C-t G</code>: display all groups and their windows</li>
<li><code>C-t g g</code>: show list of group</li>
<li><code>C-t g m</code>: move current window to group X</li>
<li><code>C-t g &lt;d&gt;</code>: go to group &lt;d&gt;</li>
</ul>
</div>
</div>


<div id="outline-container-orgb85d043" class="outline-4">
<h4 id="orgb85d043"><span class="section-number-4">7.7.6</span> Configuration</h4>
<div class="outline-text-4" id="text-7-7-6">
<pre class="example">
<code>(stumpwm:define-key stumpwm:*root-map* (stumpwm:kbd "C-z") "echo Zzzzz...")</code>
</pre>
</div>
</div>
</div>


<div id="outline-container-org3496b81" class="outline-3">
<h3 id="org3496b81"><span class="section-number-3">7.8</span> Xmonad</h3>
<div class="outline-text-3" id="text-7-8">
<p>
I use Xmonad in vncserver, and it works nicely with host WM StumpWM
because it uses a different set of keys. It has a red frame around
windows by default. That is nice for visually distinguish the local
and remote screen.
</p>

<p>
The executable is <code>xmonad</code>. Mod key is <code>alt</code>.
</p>

<ul class="org-ul">
<li><code>Mod-shift-enter</code> opens terminal.</li>
<li><code>Mod-j/k</code> move focus to windows</li>
<li><code>Mod-space</code> cycle layout</li>
<li><code>Mod-,/.</code> decrease/increase the number of panels inside the master
  (current) panel</li>
<li><code>Mod-h/l</code> resize</li>
<li><code>Mod-shift-c</code> kill</li>
<li><code>mod-p</code> execute <code>dmenu</code> (need installation)</li>
<li><code>mod-&lt;1-9&gt;</code>  switch workspace</li>
</ul>

<p>
Install <code>xmobar</code> and <code>trayer</code>.
</p>

<p>
Configuration is done in <code>/.xmonad/xmonad.hs</code>. Test whether your
configure file is syntactic-correct:
</p>

<pre class="example">
<code>xmonad --recompile</code>
</pre>

<p>
To load, use <code>Mod-q</code>. This will re-compile and load the configure file.
</p>
</div>
</div>







<div id="outline-container-org5f0a64e" class="outline-3">
<h3 id="org5f0a64e"><span class="section-number-3">7.9</span> VNC</h3>
<div class="outline-text-3" id="text-7-9">
<p>
I use tigervnc because it seems to be fast.
</p>

<ul class="org-ul">
<li>vncpasswd: set the password</li>
<li>vncserver&amp;: start the server.
<ul class="org-ul">
<li>It is started in :1 by default, so connect it with
    <code>vncviewer &lt;ip&gt;:1</code></li>
<li>On mac, the docker bridge network does not work, so you cannot
    connect to the contianer by IP addr. In this case, map the
    port 5901. 5900+N is the default VNC port.</li>
<li>vncserver -kill :1 will kill the vncserver</li>
<li>vncserver :2 will open :2</li>
</ul></li>
</ul>

<p>
<code>vncserver</code> will use <code>~/.vnc/xstartup</code> as startup script. It must have
execution permission.
</p>

<p>
<code>F8</code> to open context menu, and <code>f</code> to fullscreen. Once fullscreened,
the host WM shortcut will not be honored.
</p>

<p>
On Ubuntu, the <code>vncserver</code> will by default only listen on
localhost. Thus, need to pass <code>-localhost no</code> to enable outside
access. Nothing related to firewall (iptables or ufw). Enabling <code>ufw</code>
will actually block connection, even if I use <code>ufw enable; ufw allow
5901/tcp</code>. Just disable it.
</p>

<p>
Also, on Ubuntu, the clipboard seems not to be enabled by default. The
problem is on the server side. <code>vncconfig</code> is the helper program
specific to maintain the clipboard. You will need <code>vncconfig -nowin&amp;</code>
to start it. Probably add this to my <code>.vnc/xstartup</code>? This is not a
problem on Arch.
</p>

<p>
On GuixSD, there is no tigervnc client. I use vinagre instead.
</p>

<p>
some random settings in <code>xstartup</code>:
</p>
<pre class="example">
<code>[ -r $HOME/.Xresources ] &amp;&amp; xrdb $HOME/.Xresources</code>
</pre>
</div>
</div>
</div>



<div id="outline-container-orge90a939" class="outline-2">
<h2 id="orge90a939"><span class="section-number-2">8</span> System Management</h2>
<div class="outline-text-2" id="text-8">
<p>
The hardware beep sound is known as PC Speaker. To disable, simply
remove the kernel module:
</p>
<pre class="example">
<code>rmmod pcspkr</code>
</pre>

<p>
To use ssh key for connecting to remote ssh daemon, on the host
machine, run <code>ssh-keygen</code>. Then <code>ssh-copy-id user@server</code>.
</p>
</div>

<div id="outline-container-orgaae1ee9" class="outline-3">
<h3 id="orgaae1ee9"><span class="section-number-3">8.1</span> Audio</h3>
<div class="outline-text-3" id="text-8-1">
<p>
Bluetooth headsets:
</p>

<ul class="org-ul">
<li>bluez</li>
<li>bluez-utils</li>
<li>bluez-libs</li>
<li>pulseaudio-alsa</li>
<li>pulseaudio-bluetooth</li>
</ul>

<p>
use <code>bluetoothctl</code> to enter config:
</p>
<pre class="example">
<code>[bluetooth]# power on</code>
<code>[bluetooth]# agent on</code>
<code>[bluetooth]# default-agent</code>
<code>[bluetooth]# scan on</code>
<code>[NEW] Device 00:1D:43:6D:03:26 Lasmex LBT10</code>
<code>[bluetooth]# pair 00:1D:43:6D:03:26</code>
<code>[bluetooth]# connect 00:1D:43:6D:03:26</code>
</pre>

<p>
If you're getting a connection error org.bluez.Error.Failed retry by
killing existing PulseAudio daemon first:
</p>

<pre class="example">
<code>$ pulseaudio -k</code>
<code>[bluetooth]# connect 00:1D:43:6D:03:26</code>
</pre>
</div>
</div>



<div id="outline-container-orgb672e38" class="outline-3">
<h3 id="orgb672e38"><span class="section-number-3">8.2</span> Power Management</h3>
<div class="outline-text-3" id="text-8-2">
<p>
Power management is done through <code>systmed</code> can handle it, by <code>acpid</code>.
The configure file is <code>/etc/systemd/logind.conf</code>.  <code>man logind.conf</code>
for details.  <i>hibernate</i> will save to disk, while <i>suspend</i> save to
ram.  Both of them will resume to the current status.
</p>

<pre class="example">
<code>HandlePowerKey=hibernate</code>
<code>HandleLidSwitch=suspend</code>
</pre>
</div>
</div>

<div id="outline-container-orgfeab33a" class="outline-3">
<h3 id="orgfeab33a"><span class="section-number-3">8.3</span> Booting</h3>
<div class="outline-text-3" id="text-8-3">
<p>
The grub2 menu configure file is located at <code>/boot/grub/grub.cfg</code>.  It
is generated by <code>/usr/sbin/update-grub</code> (8) using templates from
<code>/etc/grub.d/*</code> and settings from <code>/etc/default/grub</code>.
</p>

<p>
The default run level is 2 (multi-user mode), corresponding to
<code>/etc/rc2.d/XXX</code> scripts. Those scripts starts with "S" or "K" meaning
<code>start</code> or <code>stop</code> sent to <code>systemd</code> utility.  Those scripts are symbol
linked to <code>../init.d/xxx</code>.  By default there's no difference between
level 2 to 5. Run level 0 means half, S means single user mode, 6
means reboot.
</p>
</div>
</div>

<div id="outline-container-org948f333" class="outline-3">
<h3 id="org948f333"><span class="section-number-3">8.4</span> User Management</h3>
<div class="outline-text-3" id="text-8-4">
<p>
The account will use the values on command line, <b>plus</b> the default
value for system. A group will also be created by default.
</p>

<ul class="org-ul">
<li><code>-g GROUP</code>: specify the initial login group. Typically <b>just ignore</b>
  this, the default value will be used.</li>
<li><code>-G group1,group2,...</code>: additional groups. You might want: <code>video</code>,
  <code>audio</code>, <code>wheel</code></li>
<li><code>-m</code>: create home if it does not exists</li>
<li><code>-s SHELL</code>: use this shell. Typically just ignore this, the system
  will choose for you.</li>
</ul>
</div>
</div>

<div id="outline-container-org1602543" class="outline-3">
<h3 id="org1602543"><span class="section-number-3">8.5</span> File Management</h3>
<div class="outline-text-3" id="text-8-5">
</div>
<div id="outline-container-org07bc6d7" class="outline-4">
<h4 id="org07bc6d7"><span class="section-number-4">8.5.1</span> Swap File</h4>
<div class="outline-text-4" id="text-8-5-1">
<p>
A swap file can also be used as swap memory. When doing linking, the
<code>ld</code> might fail because of lack of memory.
</p>

<p>
Check the current swap:
</p>
<pre class="example">
<code>swapon -s</code>
</pre>

<p>
Create swap file:
</p>
<pre class="example">
<code>dd if=/dev/zero of=/path/to/extraswap bs=1M count=4096</code>
</pre>

<p>
Or using <code>fallocate</code>
</p>
<pre class="example">
<code>fallocate -l 4096M /path/to/extraswap</code>
</pre>

<p>
Set the permission. A world-readable swap file is a huge
vulnerability.
</p>

<pre class="example">
<code>chmod 600 /swapfile</code>
</pre>

<p>
Format it:
</p>
<pre class="example">
<code>mkswap /path/to/extraswap</code>
</pre>

<p>
Swap on/off:
</p>
<pre class="example">
<code>swapon /path/to/extraswap</code>
<code>swapoff /path/to/extraswap</code>
</pre>

<p>
This will not be in effect after reboot. To automatically swap it on, in <code>/etc/fstab</code>
</p>
<pre class="example">
<code>/path/to/extraswap none swap sw 0 0</code>
</pre>
</div>
</div>
<div id="outline-container-orgab5a04e" class="outline-4">
<h4 id="orgab5a04e"><span class="section-number-4">8.5.2</span> Back Up &amp; Syncing</h4>
<div class="outline-text-4" id="text-8-5-2">
<p>
<code>rsync</code> commnad is used to sync from source to destination. It does
not perform double way transfer. It decides a change if either of
these happens:
</p>
<ul class="org-ul">
<li>size change</li>
<li>last-modified time</li>
</ul>
</div>
</div>

<div id="outline-container-org16f570c" class="outline-4">
<h4 id="org16f570c"><span class="section-number-4">8.5.3</span> MIME</h4>
<div class="outline-text-4" id="text-8-5-3">
<p>
check the MIME of a file.
</p>
<pre class="example">
<code>file --mime /path/to/file</code>
</pre>

<p>
On debian, the mapping from suffix to MIME type is <code>/etc/mime.types</code>.
</p>

<p>
Create default application for <code>xdg-open</code>
</p>
<pre class="example">
<code>mkdir ~/.local/share/applications</code>
<code>xdg-mime default firefox.desktop application/pdf</code>
</pre>

<p>
~/.local/share/applications/mimeapps.list
</p>
<pre class="example">
<code>[Default Applications]</code>
<code>application/pdf=firefox-esr.desktop</code>
</pre>

<p>
<code>/usr/share/applications/*.desktop</code> are files define for each
application.
</p>

<p>
On Debian, you can also do this:
</p>
<pre class="example">
<code>update-alternative --config x-terminal-emulator</code>
<code>update-alternative --config x-www-browser</code>
</pre>
</div>
</div>
</div>




<div id="outline-container-orgfe7dac2" class="outline-3">
<h3 id="orgfe7dac2"><span class="section-number-3">8.6</span> LVM</h3>
</div>

<div id="outline-container-orgbe46a72" class="outline-3">
<h3 id="orgbe46a72"><span class="section-number-3">8.7</span> Monitor the system information</h3>
<div class="outline-text-3" id="text-8-7">
<pre class="example">
<code>lvs</code>
<code>vgs</code>
<code>pvs</code>
<code>df -h</code>
<code>vgdisplay</code>
<code>lvdisplay /dev/debian-vg/home</code>
</pre>
</div>
</div>

<div id="outline-container-org67dd1f1" class="outline-3">
<h3 id="org67dd1f1"><span class="section-number-3">8.8</span> Extending a logical volume</h3>
<div class="outline-text-3" id="text-8-8">
<pre class="example">
<code>lvextend -L10G /dev/debian-vg/tmp # to 10G</code>
<code>lvextend -L+1G /dev/debian-vg/tmp # + 1G</code>
<code>resize2fs /dev/debian-vg/tmp</code>
</pre>
</div>
</div>


<div id="outline-container-org48e0c7b" class="outline-3">
<h3 id="org48e0c7b"><span class="section-number-3">8.9</span> Reduce a logical volume</h3>
<div class="outline-text-3" id="text-8-9">
<p>
The home is 890G.
</p>

<pre class="example">
<code>umount -v /home</code>
<code># check</code>
<code>e2fsck -ff /dev/debian-vg/home</code>
<code>resize2fs /dev/debian-vg/home 400G</code>
<code>lvreduce -L -490G /dev/debian-vg/home</code>
<code>lvdisplay /dev/debian-vg/home</code>
<code>resize2fs /dev/debian-vg/home</code>
<code>mount /dev/debian-vg/home /home</code>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgbd713eb" class="outline-2">
<h2 id="orgbd713eb"><span class="section-number-2">9</span> Arch Linux</h2>
<div class="outline-text-2" id="text-9">
</div>
<div id="outline-container-orgdc2e3dd" class="outline-3">
<h3 id="orgdc2e3dd"><span class="section-number-3">9.1</span> Installation</h3>
<div class="outline-text-3" id="text-9-1">
</div>
<div id="outline-container-org5527233" class="outline-4">
<h4 id="org5527233"><span class="section-number-4">9.1.1</span> Verify UEFI</h4>
<div class="outline-text-4" id="text-9-1-1">
<p>
Nowadays (start from 2017) Arch only supports 64 bits &#x2026; and seems to
prefer UEFI .. Fine
</p>

<p>
First, verify the boot mode to be UEFI by checking
the following folder exists
</p>
<pre class="example">
<code>ls /sys/firmware/efi/efivars</code>
</pre>
</div>
</div>

<div id="outline-container-orgae3c0a2" class="outline-4">
<h4 id="orgae3c0a2"><span class="section-number-4">9.1.2</span> System clock</h4>
<div class="outline-text-4" id="text-9-1-2">
<pre class="example">
<code>timedatectl set-ntp true</code>
</pre>
</div>
</div>

<div id="outline-container-org4e099a4" class="outline-4">
<h4 id="org4e099a4"><span class="section-number-4">9.1.3</span> Partition</h4>
<div class="outline-text-4" id="text-9-1-3">
<pre class="example">
<code>parted /dev/sda mklabel gpt</code>
<code>parted /dev/sda mkpart ESP fat32 1MiB 513MiB</code>
<code>parted /dev/sda set 1 boot on</code>
<code>parted /dev/sda mkpart primary linux-swap 513MiB 5GiB</code>
<code>parted /dev/sda mkpart primary ext4 5GiB 100%</code>
</pre>

<p>
This creates
</p>
<dl class="org-dl">
<dt>sda1</dt><dd><code>/boot</code> the EFI System Partition (ESP), swp, and a root</dd>
<dt>sda2</dt><dd>swap</dd>
<dt>sda3</dt><dd><code>/</code></dd>
</dl>

<p>
Format:
</p>
<pre class="example">
<code>mkfs.fat -F32 /dev/sda1</code>
<code>mkfs.ext4 /dev/sda3</code>
</pre>

<p>
Mount
</p>
<pre class="example">
<code>mount /dev/sda3 /mnt</code>
<code>mkdir /mnt/boot</code>
<code>mount /dev/sda1 /mnt/boot</code>
</pre>
</div>
</div>


<div id="outline-container-orgd200c44" class="outline-4">
<h4 id="orgd200c44"><span class="section-number-4">9.1.4</span> Select mirror</h4>
<div class="outline-text-4" id="text-9-1-4">
<p>
look into <code>/etc/pacman.d/mirrorlist</code> and modify if necessary. The order
matters. The file will be copied to new system.
</p>
</div>
</div>

<div id="outline-container-org070152b" class="outline-4">
<h4 id="org070152b"><span class="section-number-4">9.1.5</span> Install base system</h4>
<div class="outline-text-4" id="text-9-1-5">
<pre class="example">
<code>pacstrap /mnt base</code>
</pre>
</div>
</div>

<div id="outline-container-orgbbfa1a6" class="outline-4">
<h4 id="orgbbfa1a6"><span class="section-number-4">9.1.6</span> chroot</h4>
<div class="outline-text-4" id="text-9-1-6">
<pre class="example">
<code>genfstab -U /mnt &gt;&gt; /mnt/etc/fstab</code>
<code>arch-chroot /mnt</code>
</pre>
</div>
</div>

<div id="outline-container-org22a9d5d" class="outline-4">
<h4 id="org22a9d5d"><span class="section-number-4">9.1.7</span> Configure</h4>
<div class="outline-text-4" id="text-9-1-7">
<p>
Now we are in the new system.
</p>

<pre class="example">
<code>ln -sf /usr/share/zoneinfo/America/Chicago /etc/localtime</code>
<code>hwclock --systohc</code>
</pre>

<p>
Uncomment <code>en_US.UTF-8 UTF-8</code> inside <code>/etc/locale.gen</code> and run
</p>
<pre class="example">
<code>locale-gen</code>
</pre>

<p>
Set <code>LANG</code> in <code>/etc/locale.conf</code>
</p>

<pre class="example">
<code>LANG=en_US.UTF-8</code>
</pre>

<p>
Set hostname in <code>/etc/hostname</code>
</p>
<pre class="example">
<code>myhostname</code>
</pre>

<p>
Set root password
</p>
<pre class="example">
<code>passwd</code>
</pre>

<p>
Install grub
</p>
<pre class="example">
<code>pacman -S grub efibootmgr</code>
<code>grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=myarch</code>
<code>grub-mkconfig -o /boot/grub/grub.cfg</code>
</pre>

<p>
Before reboot, it is good to make sure the network will work, by
installing some networking packages:
</p>
<ul class="org-ul">
<li><code>dialog</code></li>
<li><code>wpa_suppliant</code></li>
<li><code>iw</code></li>
</ul>

<p>
Now reboot
</p>
</div>
</div>


<div id="outline-container-org46cc86a" class="outline-4">
<h4 id="org46cc86a"><span class="section-number-4">9.1.8</span> Config</h4>
<div class="outline-text-4" id="text-9-1-8">
<p>
Install the packages, and config the system using my scripts:
</p>
<ul class="org-ul">
<li>setup-quicklisp</li>
<li>setup-git</li>
</ul>
</div>
</div>


<div id="outline-container-orgca4d6bd" class="outline-4">
<h4 id="orgca4d6bd"><span class="section-number-4">9.1.9</span> Dual boot with Windows</h4>
<div class="outline-text-4" id="text-9-1-9">
<p>
The only difference is that, you do not need to create the EFI boot
partition, but use the existing one. Just mount it to boot. The rest
is the same.
</p>
</div>
</div>
</div>

<div id="outline-container-orgd983145" class="outline-3">
<h3 id="orgd983145"><span class="section-number-3">9.2</span> Pacman</h3>
<div class="outline-text-3" id="text-9-2">
<p>
Option
</p>
<dl class="org-dl">
<dt>S</dt><dd>sync, a.k.a install</dd>
<dt>Q</dt><dd>query</dd>
</dl>

<p>
Parameter:
</p>
<dl class="org-dl">
<dt>s</dt><dd>search</dd>
<dt>y</dt><dd>fetch new package list. Usually use with <code>u</code></dd>
<dt>u</dt><dd>update all packages</dd>
<dt>i</dt><dd>more information</dd>
<dt>l</dt><dd>location of files</dd>
</dl>

<p>
Typical usage:
</p>
<dl class="org-dl">
<dt>Syu</dt><dd>update whole system</dd>
<dt>S</dt><dd>install package</dd>
<dt>R</dt><dd>remove package</dd>
<dt>Rs</dt><dd>remove package and its unused dependencies</dd>
<dt>Ss</dt><dd>search package</dd>
<dt>Qi</dt><dd>show description of a package</dd>

<dt>&#x2013;noconfirm</dt><dd>use in script</dd>
<dt>&#x2013;needed</dt><dd>do not install the installed again</dd>
</dl>

<p>
Pacman will store all previously downloaded packages. So when you find
your /var/cache/pacman so big, consider clean them up using:
</p>

<pre class="example">
<code>paccache -rk 1</code>
</pre>
</div>
</div>

<div id="outline-container-org1a0f642" class="outline-3">
<h3 id="org1a0f642"><span class="section-number-3">9.3</span> AUR</h3>
<div class="outline-text-3" id="text-9-3">
<p>
Have to search through its web interface. Find the git download link
and clone it. It is pullable.
</p>

<p>
Go into the folder and
</p>
<pre class="example">
<code>makepkg -si</code>
</pre>

<p>
<code>-s</code> alone will build it, with <code>i</code> to install it after build. The
dependencies are automatically installed if can be found by pacman. If
it is also on AUR, you have to install manually.
</p>

<p>
The md5sum line can be skipped for some package. Just replace the
md5sum value inside the quotes with <code>'SKIP'</code>.
</p>
</div>
</div>
</div>

<div id="outline-container-org16a6a2a" class="outline-2">
<h2 id="org16a6a2a"><span class="section-number-2">10</span> CentOS</h2>
<div class="outline-text-2" id="text-10">
<p>
On installing a new instance of CentOS, issue the following commands:
</p>

<div class="org-src-container">
<pre class="src src-shell"><code><span class="org-comment-delimiter"># </span><span class="org-comment">check the sshd status</span></code>
<code><span class="org-comment-delimiter"># </span><span class="org-comment">should use opensshd</span></code>
<code>service status sshd</code>
<code><span class="org-comment-delimiter"># </span><span class="org-comment">add user, -m means create home folder</span></code>
<code>useradd -m myname</code>
<code><span class="org-comment-delimiter"># </span><span class="org-comment">oh, wait, I forget to add myself to wheel</span></code>
<code><span class="org-comment-delimiter"># </span><span class="org-comment">-a means append, if no -a, the -G will accept a comma separated list, overwrite the previous setting</span></code>
<code>usermod -aG wheel myname</code>
</pre>
</div>
</div>
</div>

<div id="outline-container-org304914d" class="outline-2">
<h2 id="org304914d"><span class="section-number-2">11</span> Debian</h2>
<div class="outline-text-2" id="text-11">
</div>
<div id="outline-container-orgacb5033" class="outline-3">
<h3 id="orgacb5033"><span class="section-number-3">11.1</span> Package</h3>
<div class="outline-text-3" id="text-11-1">
<ul class="org-ul">
<li><code>/etc/apt/sources.list</code></li>
<li><code>/var/cache/apt/archives/</code></li>
</ul>

<p>
<code>netselect-apt</code> to select the fastest source!
</p>

<p>
dist-upgrade
</p>
<div class="org-src-container">
<pre class="src src-sh"><code>cp /etc/apt/sources.list{,.bak}</code>
<code>sed -i -e <span class="org-string">'s/ \(stable\|wheezy\)/ testing/ig'</span> /etc/apt/sources.list</code>
<code>apt-get update</code>
<code>apt-get --download-only dist-upgrade</code>
<code><span class="org-comment-delimiter"># </span><span class="org-comment">Dangerous</span></code>
<code>apt-get dist-upgrade</code>
</pre>
</div>

<ul class="org-ul">
<li><code>dpkg-reconfigure</code> reconfigure a installed package</li>
<li><code>defconf-show</code> show the current configuration of a package</li>
</ul>

<p>
Another part is the <code>main</code>.  If you want some 3rd party contributor
packages, add <code>contrib</code> after <code>main</code>.  If you further want some
non-free packages, add also <code>non-free</code>.
</p>

<p>
To fix dependency problems:
</p>
<pre class="example">
<code>apt --fix-broken install</code>
</pre>
</div>
</div>




<div id="outline-container-org3356bf1" class="outline-3">
<h3 id="org3356bf1"><span class="section-number-3">11.2</span> Configuration</h3>
<div class="outline-text-3" id="text-11-2">
</div>
<div id="outline-container-org5abd059" class="outline-4">
<h4 id="org5abd059"><span class="section-number-4">11.2.1</span> update-alternatives</h4>
<div class="outline-text-4" id="text-11-2-1">
<p>
Options:
</p>
<ul class="org-ul">
<li><code>--config</code>: show options and select configuration interactively</li>
<li><code>--display</code>: show the options</li>
</ul>

<p>
Some examples:
</p>
<ul class="org-ul">
<li><code>update-alternatives --config desktop-background</code></li>
</ul>
</div>
</div>
</div>
</div>



<div id="outline-container-orgafd1030" class="outline-2">
<h2 id="orgafd1030"><span class="section-number-2">12</span> Docker</h2>
<div class="outline-text-2" id="text-12">
<p>
To remove the requirement of <code>sudo</code>:
</p>
<pre class="example">
<code>sudo groupadd docker</code>
<code>sudo gpasswd -a ${USER} docker</code>
<code>sudo service docker restart</code>
<code>newgrp docker</code>
</pre>

<p>
You may find yourself have to type double C-p to take effect. That is
because <code>C-p C-q</code> is the default binding for detaching a
container. This blocks C-p, I have to type it twice, must change.  In
<code>~/.docker/config.json</code>, add:
</p>

<pre class="example">
<code>{"detachKeys": "ctrl-],ctrl-["}</code>
</pre>

<p>
Restart docker daemon to take effect. This can also be set by
<code>--detach-keys</code> option.
</p>

<p>
Network config:
</p>
<ul class="org-ul">
<li>docker network ls</li>
<li>docker network inspect &lt;network-name&gt;</li>
</ul>
</div>


<div id="outline-container-org015c5f5" class="outline-3">
<h3 id="org015c5f5"><span class="section-number-3">12.1</span> Images</h3>
<div class="outline-text-3" id="text-12-1">
<p>
Docker images are template of VMs. <code>docker images</code> list available
images locally.
</p>

<p>
You can build a docker image by writing a docker file. The first line
is typically a <code>FROM</code> command to specify a base image. Other commands
are as follows:
</p>

<ul class="org-ul">
<li>RUN: this command is the most basic command. Since it expects to be
  non-interactive, when running a command such as install a package,
  supply the <code>-y</code> or equivalent arguments.</li>
<li>ENV key=value</li>
<li>ADD: <code>ADD &lt;src&gt; .. &lt;dst&gt;</code> The difference from copy:
<ul class="org-ul">
<li>ADD allows src to be url</li>
<li>ADD will decompress an archive</li>
</ul></li>
<li>COPY: <code>COPY &lt;src&gt; .. &lt;dst&gt;</code> all srcs on the local machine will be
  copied to dst in the image. The src can use wildcards. The src
  cannot be out of the current build directory, e.g. <code>..</code> is not
  valid.</li>
<li>USER: <code>USER daemon</code> The USER instruction sets the user name or UID
  to use when running the image and for any RUN, CMD and ENTRYPOINT
  instructions that follow it in the Dockerfile.</li>
<li>WORKDIR: The WORKDIR instruction sets the working directory for any
  RUN, CMD, ENTRYPOINT, COPY and ADD instructions that follow it in
  the Dockerfile
<ul class="org-ul">
<li>if it does not exist, it will be created</li>
<li>it can be used multiple times, if it is relative, it is relative
    to the previous WORKDIR</li>
</ul></li>
<li>ENTRYPOINT ["executable", "param1", "param2"]: configure the
  container to be run as an executable.</li>
</ul>

<p>
In the folder containing Dockerfile, run to build the image:
</p>

<pre class="example">
<code>docker build -t my-image .</code>
</pre>

<p>
<code>docker-compose</code> is installed seperately with docker.  It must be run
inside the folder containing <code>docker-compose.yml</code>.
</p>

<p>
Commands
</p>
<ul class="org-ul">
<li>docker-compose up: up the service. It will not exit. Use C-c to exit
  and the <code>docker-compose down</code> command will be sent.
<ul class="org-ul">
<li>The second time you up the compose, it will not up, but update
    current. If all current are up to date, nothing will happen.</li>
</ul></li>
<li>docker-compose up -d: up the service and exit. You need to shutdown
  it maually</li>
<li>docker-compose down: shutdown the services</li>
</ul>

<p>
A sample compose file:
</p>
<div class="org-src-container">
<pre class="src src-yaml"><code><span class="org-variable-name">version</span>: <span class="org-string">'2'</span></code>
<code><span class="org-variable-name">services</span>:</code>
<code>  <span class="org-variable-name">srcml-server-container</span>:</code>
<code>    <span class="org-variable-name">image</span>: <span class="org-string">"lihebi/srcml-server"</span></code>
<code>  <span class="org-variable-name">helium</span>:</code>
<code>    <span class="org-variable-name">image</span>: <span class="org-string">"lihebi/arch-helium"</span></code>
<code>    <span class="org-variable-name">tty</span>: <span class="org-constant">true</span></code>
<code>    <span class="org-variable-name">volumes</span>:</code>
<code>      - data:/data</code>
<code>  <span class="org-variable-name">benchmark-downloader</span>:</code>
<code>    <span class="org-comment-delimiter"># </span><span class="org-comment">this is used to download benchmarks to the shared volume</span></code>
<code>    <span class="org-variable-name">image</span>: <span class="org-string">"lihebi/benchmark-downloader"</span></code>
<code>    <span class="org-variable-name">tty</span>: <span class="org-constant">true</span></code>
<code>    <span class="org-variable-name">volumes</span>:</code>
<code>      - data:/data</code>
<code><span class="org-variable-name">volumes</span>:</code>
<code>  <span class="org-comment-delimiter"># </span><span class="org-comment">create a volume with default</span></code>
<code>  <span class="org-variable-name">data</span>:</code>
</pre>
</div>

<p>
A service is a container. Setting tty to true to prevent it from
stopping. That is the same effect when you pass <code>-t</code> to <code>docker run</code>.
The containers can be seen by docker ps, with names prefixed and
suffixed by <code>compose_XXX_1</code>.  Change to the container will not
preserve after the compose down. The containers will be deleted. Next
up will create new containers.
</p>

<p>
Under any volume, if <code>external</code> option is set to <code>true</code>, docker
compose will find it outside, and signal error if it does not exist.
</p>

<p>
Once the compose is up, docker create a bridge network called
<code>compose_default</code>. All services (containers) are attached to that.
</p>

<p>
You may want to publish the image so that others can use it. DockerHub
is the host for it.
</p>

<p>
When pushing and pulling, what exactly happens?
</p>

<pre class="example">
<code>docker tag local-image lihebi/my-image</code>
<code>docker push lihebi/my-image</code>
</pre>

<dl class="org-dl">
<dt>docker login</dt><dd>login so that you can push</dd>
<dt>docker push lihebi/my-container</dt><dd>push to docker hub</dd>
<dt>docker pull lihebi/my-container</dt><dd>pull from the internet</dd>
</dl>
</div>
</div>

<div id="outline-container-orga0ad51b" class="outline-3">
<h3 id="orga0ad51b"><span class="section-number-3">12.2</span> Instance</h3>
<div class="outline-text-3" id="text-12-2">
<p>
To create an instance of an image and <i>run</i> it, use the <code>docker run</code>
command. Specifically,
</p>

<ul class="org-ul">
<li><code>docker run [option] &lt;image&gt; /bin/bash</code>
<dl class="org-dl">
<dt>-i</dt><dd>interactive</dd>
<dt>-d</dt><dd>detach (opposite to -i)</dd>
<dt>-t</dt><dd>assign a tty. Even when using -d, you need this.</dd>
<dt>&#x2013;rm</dt><dd>automatically remove when exits</dd>
<dt>-p &lt;port&gt;</dt><dd>export the port &lt;port&gt; of the container. The host
                 port will be randomly assigned. Running <code>docker ps</code>
                 will show the port binding information.  If the port
                 is not set when running a container, you have to
                 commit it, and run it again to assign a port or
                 another port.</dd>
<dt>-v /volumn</dt><dd>create a mount at /volumn</dd>
<dt>-v /local/dir:/mnt</dt><dd>mount local dir to the /mnt in
       container. The default is read-write mode, if you want read
       only, do this: <code>-v /local/dir:/mnt:ro</code>. The local dir must be
       ABSOLUTE path.</dd>
</dl></li>
</ul>

<p>
To just create an instance without running it:
</p>

<p>
To run some command on an already run container, use the <code>docker exec</code>
command with the &lt;ID&gt; of the container:
</p>

<ul class="org-ul">
<li><code>docker exec &lt;ID&gt; echo "hello"</code>
<ul class="org-ul">
<li>ID can be the UUID or container name</li>
<li>you can use -it as well, e.g. docker exec -it &lt;ID&gt; /bin/bash</li>
</ul></li>
</ul>

<p>
When using <code>docker exec</code>, I cannot connect to emacs server through
emacsclient -t, and error message is terminal is not found. I can not
open tmux either. But the problem does not appear when using <code>docker
run</code> command. The problem is that, <code>docker exec</code> tty is not a real
tty.  The solution is when starting a exec command, use script to run
bash:
</p>

<pre class="example">
<code>docker exec -it my-container script -q -c "/bin/bash" /dev/null</code>
<code>docker exec -it my-container env TERM=xterm script -q -c "/bin/bash" /dev/null</code>
</pre>

<p>
The TERM is not necessary here because in my case docker always set it
to xterm. I actually change it to screen-256color in my bashrc file to
get the correct colors.
</p>


<p>
To stop a container, use <code>docker stop</code> command to do it gracefully. It
will send SIGTERM to the app, then wait for it to stop. If you don't
want to stop it gracefully, just force kill using <code>docker kill</code>.  The
default wait time is 10 seconds. You can change this to, for example,
1 second:
</p>
<pre class="example">
<code>docker stop -t 1 &lt;container-ID&gt;</code>
</pre>

<p>
The reason for a container to resist stopping may be it ignores the
SIGTERM request. Python did this, so for a python program, you should
handle this signal yourself:
</p>
<div class="org-src-container">
<pre class="src src-python"><code><span class="org-highlight-indentation"> </span> <span class="org-keyword">import</span> sys</code>
<code><span class="org-highlight-indentation"> </span> <span class="org-keyword">import</span> signal</code>
<code></code>
<code><span class="org-highlight-indentation"> </span> <span class="org-keyword">def</span> <span class="org-function-name">handler</span>(signum, frame):</code>
<code><span class="org-highlight-indentation"> </span>   <span class="org-highlight-indentation"> </span> sys.<span class="org-constant">exit</span>(1)</code>
<code></code>
<code><span class="org-highlight-indentation"> </span> <span class="org-keyword">def</span> <span class="org-function-name">main</span>():</code>
<code><span class="org-highlight-indentation"> </span>   <span class="org-highlight-indentation"> </span> signal.signal(signal.SIGTERM, hanlder)</code>
<code><span class="org-highlight-indentation"> </span>   <span class="org-highlight-indentation"> </span> <span class="org-comment-delimiter"># </span><span class="org-comment">your app</span></code>
</pre>
</div>

<p>
To stop all containers:
</p>

<pre class="example">
<code>docker stop $(docker ps -a -q)</code>
</pre>



<p>
To start a stopped container, use <code>docker start &lt;ID&gt;</code>.  It will be
detached by default.
</p>

<p>
You can remove a <i>stopped container</i> by <code>docker rm</code> command. To remove
all containers (will not remove non-stopped ones, but give errors):
</p>

<pre class="example">
<code>docker rm $(docker ps -a -q)</code>
</pre>


<p>
When you make any changes to the container, you can view the
difference made from the base image via <code>docker diff &lt;ID&gt;</code>. When
desired, you can create a new image based on the current running
instance, via <code>docker commit</code>: 
</p>

<pre class="example">
<code>docker commit &lt;ID&gt; my-new-image</code>
</pre>

<p>
You can assign a name to the container so that you can better remember
and reference it.
</p>
</div>
</div>


<div id="outline-container-orgcaf7bbd" class="outline-3">
<h3 id="orgcaf7bbd"><span class="section-number-3">12.3</span> Volume</h3>
<div class="outline-text-3" id="text-12-3">
<p>
You can create a volume by itself, using <code>docker volume create hello</code>,
or create together with a container.
</p>


<p>
You have to mount the volume at the time you create the container. You
cannot remount anything to it without commiting it to an image and
create again. Use the <code>-v</code> command to declare the volume when creating
the container:
</p>

<pre class="example">
<code>docker run -v /mnt &lt;image&gt;</code>
<code>docker run -v my-named-vol:/mnt &lt;image&gt;</code>
<code>docker run -v /absolute/path/to/host/local/path:/mnt/in/container &lt;image&gt;</code>
</pre>

<p>
If only inner path is provided, the volume will still be created, but
with a long named directory under <code>/var/lib/docker/volumes</code>.
</p>

<p>
The volumes will never be automatically deleted, even if the container
is deleted.
</p>

<p>
To manage a volume:
</p>
<ul class="org-ul">
<li><code>docker volume inspect &lt;volume-full-name&gt;</code></li>
<li><code>docker volume ls</code></li>
<li><code>docker volume prune</code>: # remove all unused volumes</li>
</ul>
</div>
</div>
</div>




<div id="outline-container-orgf11d1d2" class="outline-2">
<h2 id="orgf11d1d2"><span class="section-number-2">13</span> Unix Programming</h2>
<div class="outline-text-2" id="text-13">
<p>
<a href="http://pubs.opengroup.org/onlinepubs/9699919799/">POSIX</a> defines
 the operating system interface. The starndard contains volumes:
</p>
<ul class="org-ul">
<li>Base Definition: convention, regular expression, headers</li>
<li>System Interfaces: system calls</li>
<li>Shell &amp; Utilities: shell command language and shell utilities</li>
<li>Rationale</li>
</ul>

<p>
I found most of them are not that interesting, except Base Definition
section 9 regular expression. This definition is used by many shell
utilities such as awk.
</p>
</div>

<div id="outline-container-org54e8d28" class="outline-3">
<h3 id="org54e8d28"><span class="section-number-3">13.1</span> Low-level IO</h3>
<div class="outline-text-3" id="text-13-1">
</div>
<div id="outline-container-orgdf15197" class="outline-4">
<h4 id="orgdf15197"><span class="section-number-4">13.1.1</span> open</h4>
<div class="outline-text-4" id="text-13-1-1">
<div class="org-src-container">
<pre class="src src-C"><code><span class="org-type">int</span> <span class="org-function-name">open</span>(<span class="org-keyword">const</span> <span class="org-type">char</span> *<span class="org-variable-name">filename</span>, <span class="org-type">int</span> <span class="org-variable-name">flags</span>[, <span class="org-type">mode_t</span> <span class="org-variable-name">mode</span>])</code>
</pre>
</div>

<p>
Create and return a file descriptor.
</p>
</div>
</div>
<div id="outline-container-orge388157" class="outline-4">
<h4 id="orge388157"><span class="section-number-4">13.1.2</span> close</h4>
<div class="outline-text-4" id="text-13-1-2">
<div class="org-src-container">
<pre class="src src-C"><code><span class="org-type">int</span> <span class="org-function-name">close</span>(<span class="org-type">int</span> <span class="org-variable-name">filedes</span>)</code>
</pre>
</div>
<ul class="org-ul">
<li>file descriptor is deallocated</li>
<li>if all file descriptors associated with a pipe are closed, any
  unread data is discarded.</li>
</ul>
<p>
Return
</p>
<ul class="org-ul">
<li>0 on success, -1 on failure</li>
</ul>
</div>
</div>

<div id="outline-container-org7a75b29" class="outline-4">
<h4 id="org7a75b29"><span class="section-number-4">13.1.3</span> read</h4>
<div class="outline-text-4" id="text-13-1-3">
<div class="org-src-container">
<pre class="src src-C"><code><span class="org-type">ssize_t</span> <span class="org-function-name">read</span>(<span class="org-type">int</span> <span class="org-variable-name">filedes</span>, <span class="org-type">void</span> *<span class="org-variable-name">buffer</span>, <span class="org-type">size_t</span> <span class="org-variable-name">size</span>)</code>
</pre>
</div>
<ul class="org-ul">
<li>read <i>up to</i> size bytes, store result in buffer.</li>
</ul>
<p>
Return
</p>
<ul class="org-ul">
<li>number of bytes actually read.</li>
<li>return 0 means EOF</li>
</ul>
</div>
</div>

<div id="outline-container-org58a81fd" class="outline-4">
<h4 id="org58a81fd"><span class="section-number-4">13.1.4</span> write</h4>
<div class="outline-text-4" id="text-13-1-4">
<div class="org-src-container">
<pre class="src src-C"><code><span class="org-type">ssize_t</span> <span class="org-function-name">write</span>(<span class="org-type">int</span> <span class="org-variable-name">filedes</span>, <span class="org-keyword">const</span> <span class="org-type">void</span> *<span class="org-variable-name">buffer</span>, <span class="org-type">size_t</span> <span class="org-variable-name">size</span>)</code>
</pre>
</div>

<ul class="org-ul">
<li>write up to size bytes from buffer to the file descriptor.</li>
</ul>
<p>
Return
</p>
<ul class="org-ul">
<li>number of bytes actually written</li>
<li>-1 on failure</li>
</ul>
</div>
</div>

<div id="outline-container-org690ffaa" class="outline-4">
<h4 id="org690ffaa"><span class="section-number-4">13.1.5</span> fdopen</h4>
<div class="outline-text-4" id="text-13-1-5">
<div class="org-src-container">
<pre class="src src-C"><code><span class="org-type">FILE</span> *<span class="org-function-name">fdopen</span>(<span class="org-type">int</span> <span class="org-variable-name">filedes</span>, <span class="org-keyword">const</span> <span class="org-type">char</span> *<span class="org-variable-name">opentype</span>)</code>
</pre>
</div>

<p>
from file descriptor, get the stream
</p>
</div>
</div>

<div id="outline-container-org7896492" class="outline-4">
<h4 id="org7896492"><span class="section-number-4">13.1.6</span> fileno</h4>
<div class="outline-text-4" id="text-13-1-6">
<div class="org-src-container">
<pre class="src src-C"><code><span class="org-type">int</span> <span class="org-function-name">fileno</span>(<span class="org-type">FILE</span> *<span class="org-variable-name">stream</span>)</code>
</pre>
</div>

<p>
from stream to file descriptor
</p>
</div>
</div>

<div id="outline-container-orgc123342" class="outline-4">
<h4 id="orgc123342"><span class="section-number-4">13.1.7</span> fd<sub>set</sub></h4>
<div class="outline-text-4" id="text-13-1-7">
<p>
This is a bit array.
</p>
<ul class="org-ul">
<li>FD<sub>ZERO</sub>(&amp;fdset): initialise fdset to empty</li>
<li>FD<sub>CLR</sub>(fd, &amp;fdset): remove fd from the set</li>
<li>FD<sub>SET</sub>(fd, &amp;fdset): add fd to the set</li>
<li>FD<sub>ISSET</sub>(fd, &amp;fdset): return non-0 if fd is in set</li>
</ul>
</div>
</div>
<div id="outline-container-org6d87654" class="outline-4">
<h4 id="org6d87654"><span class="section-number-4">13.1.8</span> select - synchronous I/O multiplexing</h4>
<div class="outline-text-4" id="text-13-1-8">
<div class="org-src-container">
<pre class="src src-C"><code><span class="org-type">int</span> <span class="org-function-name">select</span>(<span class="org-type">int</span> <span class="org-variable-name">nfds</span>, <span class="org-type">fd_set</span> *<span class="org-variable-name">readfds</span>, <span class="org-type">fd_set</span> *<span class="org-variable-name">writefds</span>, <span class="org-type">fd_set</span> *<span class="org-variable-name">errorfds</span>, <span class="org-keyword">struct</span> <span class="org-type">timeval</span> *<span class="org-variable-name">timeout</span>)</code>
</pre>
</div>

<p>
Block until at least one fd is true for specific condition, unless timeout.
</p>

<p>
Params
</p>
<ul class="org-ul">
<li>nfds: the range of file descriptors to be tested. Should be the
  largest one in the sets + 1. But just pass <code>FD_SETSIZE</code>.</li>
<li>readfds: watch for read. can be NULL.</li>
<li>writefds: watch for write. can be NULL.</li>
<li>errorfds: watch for error. can be NULL.</li>
<li>timeout:
<ul class="org-ul">
<li>NULL: no timeout, block forever</li>
<li>0: return immediately. Used for test file descriptors</li>
</ul></li>
</ul>
<p>
Return:
</p>
<ul class="org-ul">
<li>if timeout, return 0</li>
<li>the sets are modified. Those in sets are those ready</li>
<li>return the number of ready file descriptors in all sets</li>
</ul>

<div class="org-src-container">
<pre class="src src-C"><code><span class="org-type">int</span> <span class="org-variable-name">fd</span>;</code>
<code><span class="org-comment-delimiter">// </span><span class="org-comment">init fd</span></code>
<code></code>
<code><span class="org-type">fd_set</span> <span class="org-variable-name">set</span>;</code>
<code>FD_ZERO(&amp;set)</code>
<code><span class="org-function-name">FD_SET</span>(fd, &amp;set);</code>
<code></code>
<code><span class="org-keyword">struct</span> <span class="org-type">timeval</span> <span class="org-variable-name">timeout</span>;</code>
<code>timeout.tv_sec = 1;</code>
<code>timeout.tv_usec = 0;</code>
<code></code>
<code><span class="org-function-name">select</span>(FD_SETSIZE, &amp;set, <span class="org-constant">NULL</span>, <span class="org-constant">NULL</span>, &amp;timeout);</code>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8c3fafc" class="outline-4">
<h4 id="org8c3fafc"><span class="section-number-4">13.1.9</span> sync</h4>
<div class="outline-text-4" id="text-13-1-9">
<div class="org-src-container">
<pre class="src src-C"><code><span class="org-type">void</span> <span class="org-function-name">sync</span>(<span class="org-type">void</span>) <span class="org-comment-delimiter">// </span><span class="org-comment">sync all dirty files</span></code>
<code><span class="org-type">int</span> <span class="org-function-name">fsync</span>(<span class="org-type">int</span> <span class="org-variable-name">filedes</span>) <span class="org-comment-delimiter">// </span><span class="org-comment">sync only that file</span></code>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcd58155" class="outline-4">
<h4 id="orgcd58155"><span class="section-number-4">13.1.10</span> dup</h4>
<div class="outline-text-4" id="text-13-1-10">
<p>
You can create a new descriptor to refer to the same file. They
</p>
<ul class="org-ul">
<li>share file position</li>
<li>share status flag</li>
<li>seperate descriptor flags</li>
</ul>

<div class="org-src-container">
<pre class="src src-C"><code><span class="org-type">int</span> <span class="org-function-name">dup</span>(<span class="org-type">int</span> <span class="org-variable-name">old</span>)</code>
<code><span class="org-comment-delimiter">// </span><span class="org-comment">same as</span></code>
<code><span class="org-function-name">fcntl</span>(old, F_DUPFD, 0)</code>
</pre>
</div>

<p>
Copy old to the first available descriptor number.
</p>

<div class="org-src-container">
<pre class="src src-C"><code><span class="org-type">int</span> <span class="org-function-name">dup2</span>(<span class="org-type">int</span> <span class="org-variable-name">old</span>, <span class="org-type">int</span> <span class="org-variable-name">new</span>)</code>
<code><span class="org-comment-delimiter">// </span><span class="org-comment">same as</span></code>
<code><span class="org-function-name">close</span>(new)</code>
<code><span class="org-function-name">fcntl</span>(old, F_DUPFD, new)</code>
</pre>
</div>

<p>
If old is invalid, it does nothing (does not close <code>new</code>)!
</p>
</div>
</div>
</div>

<div id="outline-container-org34328f3" class="outline-3">
<h3 id="org34328f3"><span class="section-number-3">13.2</span> Date and Time</h3>
<div class="outline-text-3" id="text-13-2">
<ul class="org-ul">
<li>calendar time: absolute time, e.g. 2017/6/29</li>
<li>interval: between two calendar times</li>
<li>elapsed time: length of interval</li>
<li>amount of time: sum of elapsed times</li>
<li>period: elapsed time between two events</li>
<li>CPU time: like calendar time, but relative to process, i.e. when the
  process run on CPU</li>
<li>Processor time: amount of time a CPU is in use.</li>
</ul>
</div>

<div id="outline-container-orge7fcbb5" class="outline-4">
<h4 id="orge7fcbb5"><span class="section-number-4">13.2.1</span> struct timeval</h4>
<div class="outline-text-4" id="text-13-2-1">
<ul class="org-ul">
<li>time<sub>t</sub> tv<sub>sec</sub>: seconds</li>
<li>long int tv<sub>usec</sub>: micro seconds, must be less than 1 million</li>
</ul>
</div>
</div>

<div id="outline-container-org7ffb66a" class="outline-4">
<h4 id="org7ffb66a"><span class="section-number-4">13.2.2</span> struct timespec</h4>
<div class="outline-text-4" id="text-13-2-2">
<ul class="org-ul">
<li>time<sub>t</sub> tv<sub>sec</sub></li>
<li>long int tv<sub>nsec</sub>: nanoseconds. Must be less than 1 billion</li>
</ul>
</div>
</div>

<div id="outline-container-org5e66715" class="outline-4">
<h4 id="org5e66715"><span class="section-number-4">13.2.3</span> difftime</h4>
<div class="outline-text-4" id="text-13-2-3">
<div class="org-src-container">
<pre class="src src-C"><code><span class="org-type">double</span> <span class="org-function-name">difftime</span> (<span class="org-type">time_t</span> <span class="org-variable-name">time1</span>, <span class="org-type">time_t</span> <span class="org-variable-name">time0</span>)</code>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1260206" class="outline-4">
<h4 id="org1260206"><span class="section-number-4">13.2.4</span> time<sub>t</sub></h4>
<div class="outline-text-4" id="text-13-2-4">
<p>
On GNU it is long int. It should be the seconds elapsed since 00:00:00
Jan 1 1970, Coordinated Universal Time.
</p>

<p>
get current calenddar time:
</p>
<div class="org-src-container">
<pre class="src src-C"><code><span class="org-type">time_t</span> <span class="org-function-name">time</span>(<span class="org-type">time_t</span> *<span class="org-variable-name">result</span>)</code>
</pre>
</div>
</div>
</div>

<div id="outline-container-org10df28c" class="outline-4">
<h4 id="org10df28c"><span class="section-number-4">13.2.5</span> alarm</h4>
<div class="outline-text-4" id="text-13-2-5">
</div>
<div id="outline-container-orgb4a6270" class="outline-5">
<h5 id="orgb4a6270"><span class="section-number-5">13.2.5.1</span> struct itimerval</h5>
<div class="outline-text-5" id="text-13-2-5-1">
<ul class="org-ul">
<li>struct timeval it<sub>interval</sub>: 0 to send alarm once, non-zero to send every interval</li>
<li>struct timeval it<sub>value</sub>: time left to alarm. If 0, the alarm is disabled</li>
</ul>
</div>
</div>
<div id="outline-container-org34fdbec" class="outline-5">
<h5 id="org34fdbec"><span class="section-number-5">13.2.5.2</span> setitimer</h5>
<div class="outline-text-5" id="text-13-2-5-2">
<div class="org-src-container">
<pre class="src src-C"><code><span class="org-type">int</span> <span class="org-function-name">setitimer</span>(<span class="org-type">int</span> <span class="org-variable-name">which</span>, <span class="org-keyword">const</span> <span class="org-keyword">struct</span> <span class="org-type">itimerval</span> *<span class="org-variable-name">new</span>, <span class="org-keyword">struct</span> <span class="org-type">itimerval</span> *<span class="org-variable-name">old</span>)</code>
</pre>
</div>
<ul class="org-ul">
<li>which: ITIMER<sub>REAL</sub>, ITIMER<sub>VIRTUAL</sub>, ITIMER<sub>PROF</sub></li>
<li>new: set to new</li>
<li>old: if not NULL, fill with old value</li>
</ul>
</div>
</div>

<div id="outline-container-org6ac28b9" class="outline-5">
<h5 id="org6ac28b9"><span class="section-number-5">13.2.5.3</span> getitimer(int which, struct itimerval *old)</h5>
<div class="outline-text-5" id="text-13-2-5-3">
<p>
get the timer
</p>
</div>
</div>

<div id="outline-container-orga010cfb" class="outline-5">
<h5 id="orga010cfb"><span class="section-number-5">13.2.5.4</span> alarm</h5>
<div class="outline-text-5" id="text-13-2-5-4">
<div class="org-src-container">
<pre class="src src-C"><code><span class="org-type">unsigned</span> <span class="org-type">int</span> <span class="org-function-name">alarm</span>(<span class="org-type">unsigned</span> <span class="org-type">int</span> <span class="org-variable-name">seconds</span>)</code>
</pre>
</div>
<p>
To cancel existing alarm, use alarm(0).
Return:
</p>
<ul class="org-ul">
<li>0: no previous alarm</li>
<li>non-0: the remaining value of previous alarm</li>
</ul>

<div class="org-src-container">
<pre class="src src-C"><code>  <span class="org-type">unsigned</span> <span class="org-type">int</span></code>
<code>  <span class="org-function-name">alarm</span> (<span class="org-type">unsigned</span> <span class="org-type">int</span> <span class="org-variable-name">seconds</span>)</code>
<code>  {</code>
<code>    <span class="org-keyword">struct</span> <span class="org-type">itimerval</span> <span class="org-variable-name">old</span>, <span class="org-variable-name">new</span>;</code>
<code>    new.it_interval.tv_usec = 0;</code>
<code>    new.it_interval.tv_sec = 0;</code>
<code>    new.it_value.tv_usec = 0;</code>
<code>    new.it_value.tv_sec = (<span class="org-type">long</span> <span class="org-type">int</span>) seconds;</code>
<code>    <span class="org-keyword">if</span> (setitimer (ITIMER_REAL, &amp;new, &amp;old) &lt; 0)</code>
<code>      <span class="org-keyword">return</span> 0;</code>
<code>    <span class="org-keyword">else</span></code>
<code>      <span class="org-keyword">return</span> old.it_value.tv_sec;</code>
<code>  }</code>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org5ba24cb" class="outline-3">
<h3 id="org5ba24cb"><span class="section-number-3">13.3</span> Process</h3>
<div class="outline-text-3" id="text-13-3">
<p>
Three steps
</p>
<ul class="org-ul">
<li>create child process</li>
<li>run an executable</li>
<li>coordinate the results with parent</li>
</ul>
</div>
<div id="outline-container-org02d22a6" class="outline-4">
<h4 id="org02d22a6"><span class="section-number-4">13.3.1</span> system</h4>
<div class="outline-text-4" id="text-13-3-1">
<div class="org-src-container">
<pre class="src src-C"><code><span class="org-type">int</span> <span class="org-function-name">system</span>(<span class="org-keyword">const</span> <span class="org-type">char</span> *<span class="org-variable-name">command</span>)</code>
</pre>
</div>
<ul class="org-ul">
<li>use <code>sh</code> to execute, and search in $PATH</li>
<li>return -1 on error</li>
<li>return the status code for the child</li>
</ul>
</div>
</div>
<div id="outline-container-org6fb19f2" class="outline-4">
<h4 id="org6fb19f2"><span class="section-number-4">13.3.2</span> getpid</h4>
<div class="outline-text-4" id="text-13-3-2">
<ul class="org-ul">
<li>pid<sub>t</sub> getpid(void): return PID of current process</li>
<li>pid<sub>t</sub> getppid(void): PID of parent process</li>
</ul>
</div>
</div>

<div id="outline-container-orgc23c344" class="outline-4">
<h4 id="orgc23c344"><span class="section-number-4">13.3.3</span> fork</h4>
<div class="outline-text-4" id="text-13-3-3">
<div class="org-src-container">
<pre class="src src-C"><code><span class="org-type">pid_t</span> <span class="org-function-name">fork</span>(<span class="org-type">void</span>)</code>
</pre>
</div>

<p>
return
</p>
<ul class="org-ul">
<li>0 in child</li>
<li>child's PID in parent</li>
<li>-1 on error</li>
</ul>
</div>
</div>
<div id="outline-container-org216ef71" class="outline-4">
<h4 id="org216ef71"><span class="section-number-4">13.3.4</span> pipe</h4>
<div class="outline-text-4" id="text-13-3-4">
<div class="org-src-container">
<pre class="src src-C"><code><span class="org-type">int</span> <span class="org-function-name">pipe</span>(<span class="org-type">int</span> <span class="org-variable-name">filedes</span>[2])</code>
</pre>
</div>

<ul class="org-ul">
<li>Create a pipie and puts the filedes[0] for reading, filedes[1] for writing</li>
</ul>
<p>
Return:
</p>
<ul class="org-ul">
<li>0 on success, -1 on failure</li>
</ul>
</div>
</div>

<div id="outline-container-org9d167d3" class="outline-4">
<h4 id="org9d167d3"><span class="section-number-4">13.3.5</span> exec</h4>
<div class="outline-text-4" id="text-13-3-5">
<div class="org-src-container">
<pre class="src src-C"><code><span class="org-type">int</span> <span class="org-function-name">execv</span> (<span class="org-keyword">const</span> <span class="org-type">char</span> *<span class="org-variable-name">filename</span>, <span class="org-type">char</span> *<span class="org-keyword">const</span> <span class="org-variable-name">argv</span>[])</code>
<code><span class="org-type">int</span> <span class="org-function-name">execl</span> (<span class="org-keyword">const</span> <span class="org-type">char</span> *<span class="org-variable-name">filename</span>, <span class="org-keyword">const</span> <span class="org-type">char</span> *<span class="org-variable-name">arg0</span>, ...)</code>
<code><span class="org-type">int</span> <span class="org-function-name">execve</span> (<span class="org-keyword">const</span> <span class="org-type">char</span> *<span class="org-variable-name">filename</span>, <span class="org-type">char</span> *<span class="org-keyword">const</span> <span class="org-variable-name">argv</span>[], <span class="org-type">char</span> *<span class="org-keyword">const</span> <span class="org-variable-name">env</span>[])</code>
<code><span class="org-type">int</span> <span class="org-function-name">execle</span> (<span class="org-keyword">const</span> <span class="org-type">char</span> *<span class="org-variable-name">filename</span>, <span class="org-keyword">const</span> <span class="org-type">char</span> *<span class="org-variable-name">arg0</span>, ..., <span class="org-type">char</span> *<span class="org-keyword">const</span> <span class="org-variable-name">env</span>[])</code>
<code><span class="org-type">int</span> <span class="org-function-name">execvp</span> (<span class="org-keyword">const</span> <span class="org-type">char</span> *<span class="org-variable-name">filename</span>, <span class="org-type">char</span> *<span class="org-keyword">const</span> <span class="org-variable-name">argv</span>[])</code>
<code><span class="org-type">int</span> <span class="org-function-name">execlp</span> (<span class="org-keyword">const</span> <span class="org-type">char</span> *<span class="org-variable-name">filename</span>, <span class="org-keyword">const</span> <span class="org-type">char</span> *<span class="org-variable-name">arg0</span>, ...)</code>
</pre>
</div>

<ul class="org-ul">
<li>execv: the last of argv array must be NULL. All strings are null-terminated.</li>
<li>execl: argv are seperated, the last one must be NULL</li>
<li>execve: provide env</li>
<li>execle</li>
<li>execvp: find filename in $PATH</li>
<li>execlp</li>
</ul>
</div>
</div>

<div id="outline-container-orgf2e5520" class="outline-4">
<h4 id="orgf2e5520"><span class="section-number-4">13.3.6</span> wait</h4>
<div class="outline-text-4" id="text-13-3-6">
<p>
This should be used in parent process.
</p>

<div class="org-src-container">
<pre class="src src-C"><code><span class="org-type">pid_t</span> <span class="org-function-name">waitpid</span>(<span class="org-type">pid_t</span> <span class="org-variable-name">pid</span>, <span class="org-type">int</span> *<span class="org-variable-name">status_ptr</span>, <span class="org-type">int</span> <span class="org-variable-name">options</span>)</code>
</pre>
</div>

<ul class="org-ul">
<li>pid:
<ul class="org-ul">
<li>positive: the pid for a child process</li>
<li>-1 (WAIT<sub>ANY</sub>): any child process</li>
<li>0 (WAIT<sub>MYPGRP</sub>): any child process that has the same <i>process group ID</i> as the parent</li>
<li>-pgid (any other negative value): any child process having the
    <i>process group ID</i> as gpid</li>
</ul></li>
<li>options: OR of the following
<ul class="org-ul">
<li>WNOHANG: no hang: the parent process should not wait</li>
<li>WUNTRACED: report stopped process as well as the terminated ones</li>
</ul></li>
<li>return: PID of the child process that is reporting</li>
</ul>
<div class="org-src-container">
<pre class="src src-C"><code><span class="org-type">pid_t</span> <span class="org-function-name">wait</span>(<span class="org-type">int</span> *<span class="org-variable-name">status_ptr</span>)</code>
</pre>
</div>

<p>
<code>wait(&amp;status)</code> is same as <code>waitpid(-1, &amp;status, 0)</code>
</p>
</div>

<div id="outline-container-org98205d2" class="outline-5">
<h5 id="org98205d2"><span class="section-number-5">13.3.6.1</span> Status</h5>
<div class="outline-text-5" id="text-13-3-6-1">
<p>
The signature is <code>int NAME(int status)</code>.
</p>
<ul class="org-ul">
<li>WIFEXITED: if exited: return non-0 if child terminated normally with exit</li>
<li>WEXITSTATUS: exit status: if above true, this is the low-order 8
  bits of the exit code</li>
<li>WIFSIGNALED: if signaled: non-0 if the process terminated because it
  receives a signal that was not handled</li>
<li>WTERMSIG: term sig: if above true, return that signal number</li>
<li>WCOREDUMP: core dump: non-0 if the child process terminated and
  produce a core dump</li>
<li>WIFSTOPPED: if stopped: if the child process stopped</li>
<li>WSTOPSIG: stop sig: if above true, return the signal number that
  cause the child to stop</li>
</ul>
</div>

<ol class="org-ol">
<li><a id="org98a3060"></a><span class="todo TODO">TODO</span> What is the difference between terminate and stop?<br /></li>
</ol>
</div>
</div>
</div>


<div id="outline-container-org22ba57e" class="outline-3">
<h3 id="org22ba57e"><span class="section-number-3">13.4</span> Unix Signal Handling</h3>
<div class="outline-text-3" id="text-13-4">
</div>
<div id="outline-container-orgf255bff" class="outline-4">
<h4 id="orgf255bff"><span class="section-number-4">13.4.1</span> Ordinary signal handling</h4>
<div class="outline-text-4" id="text-13-4-1">
<p>
The handling of ordinary signals are easy:
</p>

<div class="org-src-container">
<pre class="src src-C"><code><span class="org-preprocessor">  #include</span> <span class="org-string">&lt;signal.h&gt;</span></code>
<code>  <span class="org-keyword">static</span> <span class="org-type">void</span> <span class="org-function-name">my_handler</span>(<span class="org-type">int</span> <span class="org-variable-name">signum</span>) {</code>
<code>    printf(<span class="org-string">"received signal\n"</span>);</code>
<code>  }</code>
<code></code>
<code>  <span class="org-type">int</span> <span class="org-function-name">main</span>() {</code>
<code>    <span class="org-keyword">struct</span> <span class="org-type">sigaction</span> <span class="org-variable-name">sa</span>;</code>
<code>    sa.sa_handler = my_handler;</code>
<code>    sigemptyset(&amp;sa.sa_mask);</code>
<code>    sa.sa_flags = SA_SIGINFO;</code>
<code>    <span class="org-comment-delimiter">// </span><span class="org-comment">this segv does not work</span></code>
<code>    sigaction(SIGSEGV, &amp;sa, <span class="org-constant">NULL</span>);</code>
<code>    <span class="org-comment-delimiter">// </span><span class="org-comment">this sigint will work</span></code>
<code>    sigaction(SIGINT, &amp;sa, <span class="org-constant">NULL</span>);</code>
<code>  }</code>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9b1d713" class="outline-4">
<h4 id="org9b1d713"><span class="section-number-4">13.4.2</span> SIGSEGV handling</h4>
<div class="outline-text-4" id="text-13-4-2">
</div>
<div id="outline-container-org0c3076b" class="outline-5">
<h5 id="org0c3076b"><span class="section-number-5">13.4.2.1</span> Motivation</h5>
<div class="outline-text-5" id="text-13-4-2-1">
<p>
The reason that I want to handle the <code>SIGSEGV</code> is that I want to get the coverage from <code>gcov</code>.
Gcov will not report any coverage information if the program terminates by receiving some signals.
Fortunately we can explicitly ask gcov to dump it by calling <code>__gcov_flush()</code> inside the handler.
I confirmed this can work for ordinary signal handling.
</p>

<div class="org-src-container">
<pre class="src src-C"><code>  <span class="org-comment-delimiter">// </span><span class="org-comment">declaring the prototype of gcov</span></code>
<code>  <span class="org-type">void</span> <span class="org-function-name">__gcov_flush</span>(<span class="org-type">void</span>);</code>
<code></code>
<code>  <span class="org-type">void</span> <span class="org-function-name">myhanlder</span>() {</code>
<code>    __gcov_flush();</code>
<code>  }</code>
</pre>
</div>

<p>
After experiment, I found:
</p>
<ol class="org-ol">
<li>address sanitizer cannot work with this handling. AddressSanitizer will hijact the signal, and maybe output another signal.</li>
<li>Even if I turned off address sanitizer, and the handler function is executed, the coverage information is still not able to get.
      This possibly because the handler is running on a different stack.</li>
</ol>
</div>
</div>


<div id="outline-container-org0e22896" class="outline-5">
<h5 id="org0e22896"><span class="section-number-5">13.4.2.2</span> a new stack</h5>
<div class="outline-text-5" id="text-13-4-2-2">
<p>
However, handling the SIGSEGV is challenging.
The above will not work <sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>.
</p>

<blockquote>
<p>
By default, when a signal is delivered, its handler is called on the same stack where the program was running.
But if the signal is due to stack overflow, then attempting to execute the handler will cause a second segfault.
Linux is smart enough not to send this segfault back to the same signal handler, which would prevent an infinite cascade of segfaults.
Instead, in effect, the signal handler does not work.
</p>
</blockquote>

<p>
Instead, we need to make a new stack and install the handler on that stack.
</p>

<div class="org-src-container">
<pre class="src src-C"><code><span class="org-preprocessor">  #include</span> <span class="org-string">&lt;signal.h&gt;</span></code>
<code>  <span class="org-type">void</span> <span class="org-function-name">sigsegv_handler</span>(<span class="org-type">int</span> <span class="org-variable-name">signum</span>, <span class="org-type">siginfo_t</span> *<span class="org-variable-name">info</span>, <span class="org-type">void</span> *<span class="org-variable-name">data</span>) {</code>
<code>    printf(<span class="org-string">"Received signal finally\n"</span>);</code>
<code>    exit(1);</code>
<code>  }</code>
<code></code>
<code><span class="org-preprocessor">  #define</span> <span class="org-variable-name">SEGV_STACK_SIZE</span> BUFSIZ</code>
<code></code>
<code>  <span class="org-type">int</span> <span class="org-function-name">main</span>() {</code>
<code>    <span class="org-keyword">struct</span> <span class="org-type">sigaction</span> <span class="org-variable-name">action</span>;</code>
<code>    bzero(&amp;action, <span class="org-keyword">sizeof</span>(action));</code>
<code>    action.sa_flags = SA_SIGINFO|SA_STACK;</code>
<code>    action.sa_sigaction = &amp;sigsegv_handler;</code>
<code>    sigaction(SIGSEGV, &amp;action, <span class="org-constant">NULL</span>);</code>
<code></code>
<code></code>
<code>    <span class="org-type">stack_t</span> <span class="org-variable-name">segv_stack</span>;</code>
<code>    segv_stack.ss_sp = valloc(SEGV_STACK_SIZE);</code>
<code>    segv_stack.ss_flags = 0;</code>
<code>    segv_stack.ss_size = SEGV_STACK_SIZE;</code>
<code>    sigaltstack(&amp;segv_stack, <span class="org-constant">NULL</span>);</code>
<code></code>
<code>    <span class="org-type">char</span> <span class="org-variable-name">buf</span>[10];</code>
<code>    <span class="org-type">char</span> *<span class="org-variable-name">src</span> = <span class="org-string">"super long string"</span>;</code>
<code>    strcpy(buf, src);</code>
<code>  }</code>
</pre>
</div>
</div>
</div>



<div id="outline-container-org002cca4" class="outline-5">
<h5 id="org002cca4"><span class="section-number-5">13.4.2.3</span> libsigsegv</h5>
<div class="outline-text-5" id="text-13-4-2-3">
<p>
I also tried another library, the libsigsegv <sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup>.
I followed two of their methods, but I cannot make either work.
The code lists here as a reference:
</p>

<div class="org-src-container">
<pre class="src src-C"><code><span class="org-preprocessor">  #include</span> <span class="org-string">&lt;signal.h&gt;</span></code>
<code><span class="org-preprocessor">  #include</span> <span class="org-string">&lt;sigsegv.h&gt;</span></code>
<code>  <span class="org-type">int</span> <span class="org-function-name">handler</span> (<span class="org-type">void</span> *<span class="org-variable-name">fault_address</span>, <span class="org-type">int</span> <span class="org-variable-name">serious</span>) {</code>
<code>    printf(<span class="org-string">"Handler triggered.\n"</span>);</code>
<code>    <span class="org-keyword">return</span> 0;</code>
<code>  }</code>
<code>  <span class="org-type">void</span> <span class="org-function-name">stackoverflow_handler</span> (<span class="org-type">int</span> <span class="org-variable-name">emergency</span>, <span class="org-type">stackoverflow_context_t</span> <span class="org-variable-name">scp</span>) {</code>
<code>    printf(<span class="org-string">"Handler received\n"</span>);</code>
<code>  }</code>
<code>  <span class="org-type">int</span> <span class="org-function-name">main</span>() {</code>
<code>    <span class="org-type">char</span>* <span class="org-variable-name">mystack</span>; <span class="org-comment-delimiter">// </span><span class="org-comment">don't know how to use</span></code>
<code>    sigsegv_install_handler (&amp;handler);</code>
<code>    stackoverflow_install_handler (&amp;stackoverflow_handler,</code>
<code>                                   mystack, SIGSTKSZ);</code>
<code>  }</code>
</pre>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-org0954461" class="outline-3">
<h3 id="org0954461"><span class="section-number-3">13.5</span> pThread</h3>
<div class="outline-text-3" id="text-13-5">
<div class="org-src-container">
<pre class="src src-cpp"><code><span class="org-preprocessor">#include</span> <span class="org-string">&lt;pthread.h&gt;</span></code>
<code>pthread_create (thread, attr, start_routine, arg)</code>
<code>pthread_exit (status)</code>
<code>pthread_join (threadid, status)</code>
<code>pthread_detach (threadid)</code>
</pre>
</div>
</div>

<div id="outline-container-orgb88e183" class="outline-4">
<h4 id="orgb88e183"><span class="section-number-4">13.5.1</span> Create threads</h4>
<div class="outline-text-4" id="text-13-5-1">
<p>
If main() finishes before the threads it has created, and exits with
pthread<sub>exit</sub>(), the other threads will continue to execute. Otherwise,
they will be automatically terminated when main() finishes.
</p>

<div class="org-src-container">
<pre class="src src-cpp"><code><span class="org-preprocessor">  #define</span> <span class="org-variable-name">NUM_THREADS</span>     5</code>
<code></code>
<code>  <span class="org-keyword">struct</span> <span class="org-type">thread_data</span>{</code>
<code>    <span class="org-type">int</span>  <span class="org-variable-name">thread_id</span>;</code>
<code>    <span class="org-type">char</span> *<span class="org-variable-name">message</span>;</code>
<code>  };</code>
<code></code>
<code>  <span class="org-type">int</span> <span class="org-function-name">main</span>() {</code>
<code>    <span class="org-type">pthread_t</span> <span class="org-variable-name">threads</span>[NUM_THREADS];</code>
<code>    <span class="org-keyword">struct</span> <span class="org-type">thread_data</span> <span class="org-variable-name">td</span>[NUM_THREADS];</code>
<code></code>
<code>    <span class="org-type">int</span> <span class="org-variable-name">rc</span>;</code>
<code>    <span class="org-type">int</span> <span class="org-variable-name">i</span>;</code>
<code></code>
<code>    <span class="org-keyword">for</span>( i=0; i &lt; NUM_THREADS; i++ ){</code>
<code>      td[i].thread_id = i;</code>
<code>      td[i].message = <span class="org-string">"This is message"</span>;</code>
<code>      rc = pthread_create(&amp;threads[i], <span class="org-constant">NULL</span>, PrintHello, (<span class="org-type">void</span> *)&amp;td[i]);</code>
<code>      <span class="org-keyword">if</span> (rc){</code>
<code>        cout &lt;&lt; <span class="org-string">"Error:unable to create thread,"</span> &lt;&lt; rc &lt;&lt; endl;</code>
<code>        exit(-1);</code>
<code>      }</code>
<code>    }</code>
<code>    pthread_exit(<span class="org-constant">NULL</span>);</code>
<code>  }</code>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga0fb5b5" class="outline-4">
<h4 id="orga0fb5b5"><span class="section-number-4">13.5.2</span> Join and Detach</h4>
<div class="outline-text-4" id="text-13-5-2">
<div class="org-src-container">
<pre class="src src-cpp"><code>  <span class="org-type">int</span> <span class="org-function-name">main</span> () {</code>
<code>    <span class="org-type">int</span> <span class="org-variable-name">rc</span>;</code>
<code>    <span class="org-type">int</span> <span class="org-variable-name">i</span>;</code>
<code>        </code>
<code>    <span class="org-type">pthread_t</span> <span class="org-variable-name">threads</span>[NUM_THREADS];</code>
<code>    <span class="org-type">pthread_attr_t</span> <span class="org-variable-name">attr</span>;</code>
<code>    <span class="org-type">void</span> *<span class="org-variable-name">status</span>;</code>
<code></code>
<code>    <span class="org-comment-delimiter">// </span><span class="org-comment">Initialize and set thread joinable</span></code>
<code>    pthread_attr_init(&amp;attr);</code>
<code>    pthread_attr_setdetachstate(&amp;attr, PTHREAD_CREATE_JOINABLE);</code>
<code></code>
<code>    <span class="org-keyword">for</span>( i=0; i &lt; NUM_THREADS; i++ ){</code>
<code>      cout &lt;&lt; <span class="org-string">"main() : creating thread, "</span> &lt;&lt; i &lt;&lt; endl;</code>
<code>      rc = pthread_create(&amp;threads[i], &amp;attr, wait, (<span class="org-type">void</span> *)i );</code>
<code>                </code>
<code>      <span class="org-keyword">if</span> (rc){</code>
<code>        cout &lt;&lt; <span class="org-string">"Error:unable to create thread,"</span> &lt;&lt; rc &lt;&lt; endl;</code>
<code>        exit(-1);</code>
<code>      }</code>
<code>    }</code>
<code></code>
<code>    <span class="org-comment-delimiter">// </span><span class="org-comment">free attribute and wait for the other threads</span></code>
<code>    pthread_attr_destroy(&amp;attr);</code>
<code>        </code>
<code>    <span class="org-keyword">for</span>( i=0; i &lt; NUM_THREADS; i++ ){</code>
<code>      rc = pthread_join(threads[i], &amp;status);</code>
<code>                </code>
<code>      <span class="org-keyword">if</span> (rc){</code>
<code>        cout &lt;&lt; <span class="org-string">"Error:unable to join,"</span> &lt;&lt; rc &lt;&lt; endl;</code>
<code>        exit(-1);</code>
<code>      }</code>
<code>                </code>
<code>      cout &lt;&lt; <span class="org-string">"Main: completed thread id :"</span> &lt;&lt; i ;</code>
<code>      cout &lt;&lt; <span class="org-string">"  exiting with status :"</span> &lt;&lt; status &lt;&lt; endl;</code>
<code>    }</code>
<code></code>
<code>    cout &lt;&lt; <span class="org-string">"Main: program exiting."</span> &lt;&lt; endl;</code>
<code>    pthread_exit(<span class="org-constant">NULL</span>);</code>
<code>  }</code>
</pre>
</div>
</div>
</div>
</div>



<div id="outline-container-orgafc3882" class="outline-3">
<h3 id="orgafc3882"><span class="section-number-3">13.6</span> Other</h3>
<div class="outline-text-3" id="text-13-6">
<p>
sleep
</p>
<div class="org-src-container">
<pre class="src src-C"><code><span class="org-preprocessor">#include</span> <span class="org-string">&lt;unistd.h&gt;</span></code>
<code><span class="org-type">unsigned</span> <span class="org-type">int</span> <span class="org-function-name">sleep</span>(<span class="org-type">unsigned</span> <span class="org-type">int</span> <span class="org-variable-name">seconds</span>); <span class="org-comment-delimiter">// </span><span class="org-comment">seconds</span></code>
<code><span class="org-type">int</span> <span class="org-function-name">usleep</span>(<span class="org-type">useconds_t</span> <span class="org-variable-name">useconds</span>); <span class="org-comment-delimiter">// </span><span class="org-comment">microseconds</span></code>
<code><span class="org-type">int</span> <span class="org-function-name">nanosleep</span>(<span class="org-keyword">const</span> <span class="org-keyword">struct</span> <span class="org-type">timespec</span> *<span class="org-variable-name">rqtp</span>, <span class="org-keyword">struct</span> <span class="org-type">timespec</span> *<span class="org-variable-name">rmtp</span>);</code>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgefae849" class="outline-2">
<h2 id="orgefae849"><span class="section-number-2">14</span> Shell Utilities</h2>
<div class="outline-text-2" id="text-14">
<ul class="org-ul">
<li>sort -k 4 -n</li>
<li>tee</li>
</ul>
<div class="org-src-container">
<pre class="src src-sh"><code>  <span class="org-keyword">for</span> name<span class="org-keyword"> in</span> data/github-bench/*; <span class="org-keyword">do</span> </code>
<code>      <span class="org-builtin">echo</span> <span class="org-string">"===== $name"</span><span class="org-sh-escaped-newline">\</span></code>
<code>          | tee -a log.txt; { <span class="org-keyword">time</span> helium --create-cache $<span class="org-variable-name">name</span>; } 2&gt;&amp;1<span class="org-sh-escaped-newline">\</span></code>
<code>          | tee -a log.txt; <span class="org-keyword">done</span></code>
</pre>
</div>

<p>
Another example: redirect output of time
</p>
<pre class="example">
<code>{ time sleep 1 ; } 2&gt; time.txt</code>
<code>{ time sleep 1 ; } 2&gt;&amp;1 | tee -a time.txt</code>
</pre>


<ul class="org-ul">
<li>xz: a general-purpose data compression tool</li>
<li>cpio: copy files between archives and directories</li>

<li>shuf: random number generation</li>
</ul>
<div class="org-src-container">
<pre class="src src-shell"><code>shuf -i 1-100 -n 1</code>
</pre>
</div>
<ul class="org-ul">
<li><code>bc</code> calculator</li>

<li>grep: -i (case insensitive), -n (show line number), -v (inverse), -H
  (show file name)</li>

<li>xargs: consume the standard output, and integrate result with new
  command:</li>
</ul>

<div class="org-src-container">
<pre class="src src-shell"><code>find /etc -name <span class="org-string">'*.conf'</span> | xargs ls -l</code>
<code><span class="org-comment-delimiter"># </span><span class="org-comment">the same as:</span></code>
<code>ls -l ~find ...~</code>
</pre>
</div>

<ul class="org-ul">
<li><code>time &lt;command&gt;</code>: # the total user and system time consumed by the shell and its children</li>
<li><code>column</code>: formats its input into multiple columns. <code>mount | column -t</code></li>
<li><code>dd</code>: <code>dd if=xxx.iso of=/dev/sdb bs=4m; sync</code></li>
<li><code>convert</code>: <code>convert xxx.jpg -resize 800 xxx.out.jpg # 800x&lt;height&gt;</code></li>
<li><code>nl</code>: <code>nl &lt;filename&gt;</code> 添加行号。输出到stdout</li>
<li><code>ln</code>: <code>ln -s &lt;target&gt; &lt;linkname&gt;</code> 记忆：新的东西总要最后才发布。</li>
<li><code>ls</code>: order: <code>-r</code> reverse; <code>-s</code> file size; <code>X</code> extension; <code>-t</code> time</li>
</ul>
</div>


<div id="outline-container-org858acab" class="outline-3">
<h3 id="org858acab"><span class="section-number-3">14.1</span> Patch System</h3>
<div class="outline-text-3" id="text-14-1">
<p>
Create a patch (notice the order: old then new):
</p>
<pre class="example">
<code>diff -u hello.c hello_new.c &gt; hello.patch</code>
<code>diff -Naur /usr/src/openvpn-2.3.2 /usr/src/openvpn-2.3.4 &gt; openvpn.patch</code>
</pre>

<p>
To apply a patch
</p>
<pre class="example">
<code>patch -p3 &lt; /path/to/openvpn.patch</code>
<code>patch -p1 &lt;patch -d /path/to/old/file</code>
</pre>

<p>
the number after <code>p</code> indicates how many the leading slashes are skipped when find the old file
</p>

<p>
To reverse (un-apply) a patch:
</p>

<pre class="example">
<code>patch -p1 -R &lt;patch</code>
</pre>

<p>
This works as if you swapped the old and new file when creating the patch.
</p>
</div>
</div>

<div id="outline-container-orgf2394bb" class="outline-3">
<h3 id="orgf2394bb"><span class="section-number-3">14.2</span> tr: translate characters</h3>
<div class="outline-text-3" id="text-14-2">
<p>
tr &lt;string1&gt; &lt;string2&gt;
</p>

<p>
the characters in string1 are translated into the characters in string2
where the first character in string1 is translated into the first character in string2 and so on.  If string1 is longer than string2,
the last character found in string2 is duplicated until string1 is exhausted.
</p>

<p>
characters in the string can be:
</p>

<p>
any characters will represent itself if not:
</p>

<ul class="org-ul">
<li><code>\\octal</code>: A backslash followed by 1, 2 or 3 octal digits</li>
<li><code>\n</code>, <code>\t</code></li>
<li><code>a-z</code>: inclusive, ascending</li>
<li><code>[:class:]</code>: space, upper, lower, alnum
<ul class="org-ul">
<li>if <code>[:upper:]</code> and <code>[:lower:]</code> appears in the same relative position, they will correlate.</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org2996428" class="outline-3">
<h3 id="org2996428"><span class="section-number-3">14.3</span> uniq: report or filter out repeated lines in a file</h3>
<div class="outline-text-3" id="text-14-3">
<p>
Repeated lines in the input will not be detected if they are not adjacent,
so it may be necessary to sort the files first.
</p>

<ul class="org-ul">
<li><code>uniq -c</code>: Precede each output line with the count of the number of
   times the line occurred in the input, followed by a single
   space. You can then comtine this with <code>sort -n</code></li>
<li><code>-u</code>: Only output lines that are not repeated in the input.</li>
<li><code>-i</code>: Case insensitive comparison of lines.</li>
</ul>
</div>
</div>

<div id="outline-container-org48ab40f" class="outline-3">
<h3 id="org48ab40f"><span class="section-number-3">14.4</span> Find</h3>
<div class="outline-text-3" id="text-14-4">
<div class="org-src-container">
<pre class="src src-shell"><code>find . -type f -name *.flac -exec mv {} ../out/ <span class="org-string">\;</span></code>
</pre>
</div>
<p>
Copy file based on find, and take care of quotes and spaces:
</p>
<div class="org-src-container">
<pre class="src src-shell"><code>find CloudMusic -type f -name <span class="org-string">"*mp3"</span> -exec cp <span class="org-string">"{}"</span> all_music <span class="org-string">\;</span></code>
</pre>
</div>

<ul class="org-ul">
<li>find</li>
</ul>
<pre class="example">
<code>find ~/data/fast/pick-master/ -name '*.[ch]'</code>
</pre>
</div>
</div>
</div>



<div id="outline-container-org38d4bd3" class="outline-2">
<h2 id="org38d4bd3"><span class="section-number-2">15</span> Trouble Shooting</h2>
<div class="outline-text-2" id="text-15">
</div>
<div id="outline-container-orgb0684ba" class="outline-3">
<h3 id="orgb0684ba"><span class="section-number-3">15.1</span> Cannot su root</h3>
<div class="outline-text-3" id="text-15-1">
<p>
When su cannot change to root, run
</p>
<pre class="example">
<code>chmod u+s /bin/su</code>
</pre>
</div>
</div>

<div id="outline-container-org78fd83b" class="outline-3">
<h3 id="org78fd83b"><span class="section-number-3">15.2</span> in docker, cannot open chromium</h3>
<div class="outline-text-3" id="text-15-2">
<blockquote>
<p>
failed to move to new namespace: PID namespaces supported, Network
namespace supported, but failed: errno = Operation not permitted.
</p>
</blockquote>

<p>
Solution
</p>
<pre class="example">
<code>chromium --no-sandbox</code>
</pre>
</div>
</div>
<div id="outline-container-org3d5c561" class="outline-3">
<h3 id="org3d5c561"><span class="section-number-3">15.3</span> Encoding</h3>
<div class="outline-text-3" id="text-15-3">
<p>
When converting MS windows format to unix format, you can use emacs
and call <code>set-buffer-file-coding-system</code> and set to unix.  Or you can
use <code>dos2unix</code>, perhaps by
</p>

<pre class="example">
<code>find . -name *.java | xargs dos2unix</code>
</pre>
</div>
</div>

<div id="outline-container-orge5ec8b6" class="outline-3">
<h3 id="orge5ec8b6"><span class="section-number-3">15.4</span> Cannot open shared library</h3>
<div class="outline-text-3" id="text-15-4">
<p>
On <code>CentOS</code>, the default <code>LD_LIBRARY_PATH</code> does not contains the
<code>/usr/local/lib</code>.  The consequence is the <code>-lpugi</code> and <code>-lctags</code> are
not recognized because they are put in that directory.  Set it, or
edit <code>/etc/ld.conf.d/local.conf</code> and add the path.  After that, run
<code>ldconf</code> as root to update the database.
</p>
</div>
</div>


<div id="outline-container-orgd83cdb2" class="outline-3">
<h3 id="orgd83cdb2"><span class="section-number-3">15.5</span> auto expansion error for latex font</h3>
<div class="outline-text-3" id="text-15-5">
<p>
when compiling latex using acmart template, auto expansion error is
reported.
</p>

<p>
Solution:
</p>
<pre class="example">
<code>mktexlsr # texhash</code>
<code>updmap-sys</code>
</pre>

<p>
Reference: <a href="https://github.com/borisveytsman/acmart/issues/95">https://github.com/borisveytsman/acmart/issues/95</a>
</p>
</div>
</div>

<div id="outline-container-orgcf5bed1" class="outline-3">
<h3 id="orgcf5bed1"><span class="section-number-3">15.6</span> time not up-to-date</h3>
<div class="outline-text-3" id="text-15-6">
<p>
Although I set the right timezone (check by <code>timedatectl</code>), the clock
is still incorrect. To fix that, install <code>ntp</code> package and run
</p>

<pre class="example">
<code>sudo ntpd -qg</code>
</pre>
</div>
</div>

<div id="outline-container-orge306174" class="outline-3">
<h3 id="orge306174"><span class="section-number-3">15.7</span> backlight on TP25</h3>
<div class="outline-text-3" id="text-15-7">
<p>
For regular laptops, using debian
</p>

<pre class="example">
<code>cat /sys/class/backlight/intel_backlight/max_brightness</code>
<code>cat /sys/class/backlight/intel_backlight/brightness</code>
<code></code>
<code>echo 400 &gt; /sys/class/backlight/intel_backlight/brightness</code>
</pre>

<p>
But on Archlinux, on TP25, The <code>xorg-xbacklight</code> is not working. The
drop-in replacement <code>acpilight</code> (aur) does.
</p>

<p>
To setup for video group users to adjust backlight, place a file
<code>/etc/udev/rules.d/90-backlight.rules</code>
</p>

<pre class="example">
<code>SUBSYSTEM=="backlight", ACTION=="add", \</code>
<code>  RUN+="/bin/chgrp video %S%p/brightness", \</code>
<code>  RUN+="/bin/chmod g+w %S%p/brightness"</code>
</pre>

<p>
The command is still <code>xbacklight</code>.
</p>
</div>
</div>
<div id="outline-container-orgc5ce462" class="outline-3">
<h3 id="orgc5ce462"><span class="section-number-3">15.8</span> xinit won't start</h3>
<div class="outline-text-3" id="text-15-8">
<p>
On Debian, when I <code>dist-upgrade</code> Debian 8 Jessie to 9 Stretch,
the <code>startx</code> stop working.
I try install a Debian 9 from its own image, and still the same result.
The error message says:
</p>
<blockquote>
<p>
vesa cannot read int vect
screen found but none leave a usable configuration
xf86enableioports failed to set iopl for i/o
</p>
</blockquote>

<p>
The trick is you need:
</p>
<pre class="example">
<code>chomd u+s /usr/bin/xinit</code>
</pre>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
<a href="https://rethinkdb.com/blog/handling-stack-overflow-on-custom-stacks/">https://rethinkdb.com/blog/handling-stack-overflow-on-custom-stacks/</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara">
<a href="https://www.gnu.org/software/libsigsegv/">https://www.gnu.org/software/libsigsegv/</a>
</p></div></div>


</div>
</div></div>
</body>
</html>
